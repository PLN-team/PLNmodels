<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sparse structure estimation for multivariate count data with PLN-network • PLNmodels</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sparse structure estimation for multivariate count data with PLN-network">
<meta property="og:description" content="PLNmodels">
<meta property="og:image" content="https://pln-team.github.io/PLNmodels/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PLNmodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.11.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://pln-team.github.io/slideshow/slides">Slideshow on PLN</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Trichoptera.html">The trichoptera data set</a>
    </li>
    <li>
      <a href="../articles/Import_data.html">Data importation in PLNmodels</a>
    </li>
    <li>
      <a href="../articles/PLN.html">PLN: Multivariate Poisson regression</a>
    </li>
    <li>
      <a href="../articles/PLNPCA.html">PLNPCA: Dimension Reduction</a>
    </li>
    <li>
      <a href="../articles/PLNnetwork.html">PLNnetwork: sparse structure inference</a>
    </li>
    <li>
      <a href="../articles/PLNLDA.html">PLNLDA: Discriminant Analysis</a>
    </li>
    <li>
      <a href="../articles/PLNmixture.html">PLNmixture: Model-based clustering for counts</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pln-team/PLNmodels/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="PLNnetwork_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Sparse structure estimation for multivariate count data with PLN-network</h1>
                        <h4 class="author">PLN team</h4>
            
            <h4 class="date">2021-03-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pln-team/PLNmodels/blob/master/vignettes/PLNnetwork.Rmd"><code>vignettes/PLNnetwork.Rmd</code></a></small>
      <div class="hidden name"><code>PLNnetwork.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<p>This vignette illustrates the standard use of the <code>PLNnetwork</code> function and the methods accompanying the R6 Classes <code>PLNnetworkfamily</code> and <code>PLNnetworkfit</code>.</p>
<div id="requirements" class="section level3">
<h3 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h3>
<p>The packages required for the analysis are <strong>PLNmodels</strong> plus some others for data manipulation and representation:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://pln-team.github.io/PLNmodels/">PLNmodels</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#data-set" class="anchor"></a>Data set</h3>
<p>We illustrate our point with the trichoptera data set, a full description of which can be found in <a href="Trichoptera.html">the corresponding vignette</a>. Data preparation is also detailed in <a href="Import_data.html">the specific vignette</a>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="va">trichoptera</span><span class="op">)</span>
<span class="va">trichoptera</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="va">trichoptera</span><span class="op">$</span><span class="va">Abundance</span>, <span class="va">trichoptera</span><span class="op">$</span><span class="va">Covariate</span><span class="op">)</span></code></pre></div>
<p>The <code>trichoptera</code> data frame stores a matrix of counts (<code>trichoptera$Abundance</code>), a matrix of offsets (<code>trichoptera$Offset</code>) and some vectors of covariates (<code>trichoptera$Wind</code>, <code>trichoptera$Temperature</code>, etc.)</p>
</div>
<div id="mathematical-background" class="section level3">
<h3 class="hasAnchor">
<a href="#mathematical-background" class="anchor"></a>Mathematical background</h3>
<p>The network model for multivariate count data that we introduce in <span class="citation">Chiquet, Robin, and Mariadassou (<a href="#ref-PLNnetwork" role="doc-biblioref">2019</a>)</span> is a variant of the Poisson Lognormal model of <span class="citation">Aitchison and Ho (<a href="#ref-AiH89" role="doc-biblioref">1989</a>)</span>, see <a href="PLN.html">the PLN vignette</a> as a reminder. Compare to the standard PLN model we add a sparsity constraint on the inverse covariance matrix <span class="math inline">\({\boldsymbol\Sigma}^{-1}\triangleq \boldsymbol\Omega\)</span> by means of the <span class="math inline">\(\ell_1\)</span>-norm, such that <span class="math inline">\(\|\boldsymbol\Omega\|_1 &lt; c\)</span>. PLN-network is the equivalent of the sparse multivariate Gaussian model <span class="citation">(Banerjee, Ghaoui, and d’Aspremont <a href="#ref-banerjee2008" role="doc-biblioref">2008</a>)</span> in the PLN framework. It relates some <span class="math inline">\(p\)</span>-dimensional observation vectors <span class="math inline">\(\mathbf{Y}_i\)</span> to some <span class="math inline">\(p\)</span>-dimensional vectors of Gaussian latent variables <span class="math inline">\(\mathbf{Z}_i\)</span> as follows <span class="math display">\[\begin{equation} 
  \begin{array}{rcl}
  \text{latent space } &amp;   \mathbf{Z}_i \sim \mathcal{N}\left({\boldsymbol\mu},\boldsymbol\Omega^{-1}\right) &amp;  \|\boldsymbol\Omega\|_1 &lt; c \\
  \text{observation space } &amp;  Y_{ij} | Z_{ij} \quad \text{indep.} &amp; Y_{ij} | Z_{ij} \sim \mathcal{P}\left(\exp\{Z_{ij}\}\right)
  \end{array}
\end{equation}\]</span></p>
<p>The parameter <span class="math inline">\({\boldsymbol\mu}\)</span> corresponds to the main effects and the latent covariance matrix <span class="math inline">\(\boldsymbol\Sigma\)</span> describes the underlying structure of dependence between the <span class="math inline">\(p\)</span> variables.</p>
<p>The <span class="math inline">\(\ell_1\)</span>-penalty on <span class="math inline">\(\boldsymbol\Omega\)</span> induces sparsity and selection of important direct relationships between entities. Hence, the support of <span class="math inline">\(\boldsymbol\Omega\)</span> correspond to a network of underlying interactions. The sparsity level (<span class="math inline">\(c\)</span> in the above mathematical model), which corresponds to the number of edges in the network, is controlled by a penalty parameter in the optimization process sometimes referred to as <span class="math inline">\(\lambda\)</span>. All mathematical details can be found in <span class="citation">Chiquet, Robin, and Mariadassou (<a href="#ref-PLNnetwork" role="doc-biblioref">2019</a>)</span>.</p>
<div id="covariates-and-offsets" class="section level4">
<h4 class="hasAnchor">
<a href="#covariates-and-offsets" class="anchor"></a>Covariates and offsets</h4>
<p>Just like PLN, PLN-network generalizes to a formulation close to a multivariate generalized linear model where the main effect is due to a linear combination of <span class="math inline">\(d\)</span> covariates <span class="math inline">\(\mathbf{x}_i\)</span> and to a vector <span class="math inline">\(\mathbf{o}_i\)</span> of <span class="math inline">\(p\)</span> offsets in sample <span class="math inline">\(i\)</span>. The latent layer then reads <span class="math display">\[\begin{equation} 
  \mathbf{Z}_i \sim \mathcal{N}\left({\mathbf{o}_i + \mathbf{x}_i^\top\boldsymbol\Theta},\boldsymbol\Omega^{-1}\right), \qquad \|\boldsymbol\Omega\|_1 &lt; c ,
\end{equation}\]</span> where <span class="math inline">\(\boldsymbol\Theta\)</span> is a <span class="math inline">\(d\times p\)</span> matrix of regression parameters.</p>
</div>
<div id="alternating-optimization" class="section level4">
<h4 class="hasAnchor">
<a href="#alternating-optimization" class="anchor"></a>Alternating optimization</h4>
<p>Regularization via sparsification of <span class="math inline">\(\boldsymbol\Omega\)</span> and visualization of the consecutive network is the main objective in PLN-network. To reach this goal, we need to first estimate the model parameters. Inference in PLN-network focuses on the regression parameters <span class="math inline">\(\boldsymbol\Theta\)</span> and the inverse covariance <span class="math inline">\(\boldsymbol\Omega\)</span>. Technically speaking, we adopt a variational strategy to approximate the <span class="math inline">\(\ell_1\)</span>-penalized log-likelihood function and optimize the consecutive sparse variational surrogate with an optimization scheme that alternates between two step</p>
<ol style="list-style-type: decimal">
<li>a gradient-ascent-step, performed with the CCSA algorithm of <span class="citation">Svanberg (<a href="#ref-Svan02" role="doc-biblioref">2002</a>)</span> implemented in the C++ library <span class="citation">(Johnson <a href="#ref-nlopt" role="doc-biblioref">2011</a>)</span>, which we link to the package.</li>
<li>a penalized log-likelihood step, performed with the graphical-Lasso of <span class="citation">Friedman, Hastie, and Tibshirani (<a href="#ref-FHT08" role="doc-biblioref">2008</a>)</span>, implemented in the package <strong>fastglasso</strong> <span class="citation">(Sustik and Calderhead <a href="#ref-glassofast" role="doc-biblioref">2012</a>)</span>.</li>
</ol>
<p>More technical details can be found in <span class="citation">Chiquet, Robin, and Mariadassou (<a href="#ref-PLNnetwork" role="doc-biblioref">2019</a>)</span></p>
</div>
</div>
</div>
<div id="analysis-of-trichoptera-data-with-a-plnnetwork-model" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-trichoptera-data-with-a-plnnetwork-model" class="anchor"></a>Analysis of trichoptera data with a PLNnetwork model</h2>
<p>In the package, the sparse PLN-network model is adjusted with the function <code>PLNnetwork</code>, which we review in this section. This function adjusts the model for a series of value of the penalty parameter controlling the number of edges in the network. It then provides a collection of objects with class <code>PLNnetworkfit</code>, corresponding to networks with different levels of density, all stored in an object with class <code>PLNnetworkfamily</code>.</p>
<div id="adjusting-a-collection-of-network---a-k-a--a-regularization-path" class="section level3">
<h3 class="hasAnchor">
<a href="#adjusting-a-collection-of-network---a-k-a--a-regularization-path" class="anchor"></a>Adjusting a collection of network - a.k.a. a regularization path</h3>
<p><code>PLNnetwork</code> finds an hopefully appropriate set of penalties on its own. This set can be controlled by the user, but use it with care and check details in <code><a href="../reference/PLNnetwork.html">?PLNnetwork</a></code>. The collection of models is fitted as follows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">network_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLNnetwork.html">PLNnetwork</a></span><span class="op">(</span><span class="va">Abundance</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Offset</span><span class="op">)</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">trichoptera</span><span class="op">)</span></code></pre></div>
<pre><code>## 
##  Initialization...
##  Adjusting 30 PLN with sparse inverse covariance estimation
##  Joint optimization alternating gradient descent and graphical-lasso
##  sparsifying penalty = 3.632478 
    sparsifying penalty = 3.355214 
    sparsifying penalty = 3.099114 
    sparsifying penalty = 2.862561 
    sparsifying penalty = 2.644064 
    sparsifying penalty = 2.442245 
    sparsifying penalty = 2.25583 
    sparsifying penalty = 2.083645 
    sparsifying penalty = 1.924602 
    sparsifying penalty = 1.777699 
    sparsifying penalty = 1.642009 
    sparsifying penalty = 1.516675 
    sparsifying penalty = 1.400909 
    sparsifying penalty = 1.293979 
    sparsifying penalty = 1.19521 
    sparsifying penalty = 1.103981 
    sparsifying penalty = 1.019715 
    sparsifying penalty = 0.9418812 
    sparsifying penalty = 0.8699882 
    sparsifying penalty = 0.8035827 
    sparsifying penalty = 0.742246 
    sparsifying penalty = 0.685591 
    sparsifying penalty = 0.6332604 
    sparsifying penalty = 0.5849242 
    sparsifying penalty = 0.5402774 
    sparsifying penalty = 0.4990385 
    sparsifying penalty = 0.4609473 
    sparsifying penalty = 0.4257636 
    sparsifying penalty = 0.3932654 
    sparsifying penalty = 0.3632478 
##  Post-treatments
##  DONE!</code></pre>
<p>Note the use of the <code>formula</code> object to specify the model, similar to the one used in the function <code>PLN</code>.</p>
</div>
<div id="structure-of-plnnetworkfamily" class="section level3">
<h3 class="hasAnchor">
<a href="#structure-of-plnnetworkfamily" class="anchor"></a>Structure of <code>PLNnetworkfamily</code>
</h3>
<p>The <code>network_models</code> variable is an <code>R6</code> object with class <code>PLNnetworkfamily</code>, which comes with a couple of methods. The most basic is the <code>show/print</code> method, which sends a very basic summary of the estimation process:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">network_models</span></code></pre></div>
<pre><code>## --------------------------------------------------------
## COLLECTION OF 30 POISSON LOGNORMAL MODELS
## --------------------------------------------------------
##  Task: Network Inference 
## ========================================================
##  - 30 penalties considered: from 0.3632478 to 3.632478 
##  - Best model (greater BIC): lambda = 1.4 
##  - Best model (greater EBIC): lambda = 1.4</code></pre>
<p>One can also easily access the successive values of the criteria in the collection</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">network_models</span><span class="op">$</span><span class="va">criteria</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param</th>
<th align="right">nb_param</th>
<th align="right">loglik</th>
<th align="right">BIC</th>
<th align="right">ICL</th>
<th align="right">n_edges</th>
<th align="right">EBIC</th>
<th align="right">pen_loglik</th>
<th align="right">density</th>
<th align="left">stability</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3.632478</td>
<td align="right">17</td>
<td align="right">-1293.019</td>
<td align="right">-1326.100</td>
<td align="right">-2797.538</td>
<td align="right">0</td>
<td align="right">-1326.100</td>
<td align="right">-1299.263</td>
<td align="right">0.0000000</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3.355214</td>
<td align="right">17</td>
<td align="right">-1287.687</td>
<td align="right">-1320.767</td>
<td align="right">-2792.201</td>
<td align="right">0</td>
<td align="right">-1320.767</td>
<td align="right">-1293.663</td>
<td align="right">0.0000000</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3.099114</td>
<td align="right">17</td>
<td align="right">-1282.540</td>
<td align="right">-1315.621</td>
<td align="right">-2787.055</td>
<td align="right">0</td>
<td align="right">-1315.621</td>
<td align="right">-1288.262</td>
<td align="right">0.0000000</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2.862561</td>
<td align="right">18</td>
<td align="right">-1277.616</td>
<td align="right">-1312.642</td>
<td align="right">-2784.076</td>
<td align="right">1</td>
<td align="right">-1315.099</td>
<td align="right">-1283.094</td>
<td align="right">0.0069204</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2.644064</td>
<td align="right">18</td>
<td align="right">-1272.864</td>
<td align="right">-1307.890</td>
<td align="right">-2779.324</td>
<td align="right">1</td>
<td align="right">-1310.347</td>
<td align="right">-1278.110</td>
<td align="right">0.0069204</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2.442245</td>
<td align="right">18</td>
<td align="right">-1268.415</td>
<td align="right">-1303.441</td>
<td align="right">-2774.875</td>
<td align="right">1</td>
<td align="right">-1305.897</td>
<td align="right">-1273.435</td>
<td align="right">0.0069204</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>A diagnostic of the optimization process is available via the <code>convergence</code> field:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">network_models</span><span class="op">$</span><span class="va">convergence</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="4%">
<col width="7%">
<col width="7%">
<col width="9%">
<col width="9%">
<col width="13%">
<col width="13%">
<col width="10%">
<col width="25%">
</colgroup>
<thead><tr class="header">
<th align="left"></th>
<th align="right">param</th>
<th align="left">nb_param</th>
<th align="left">objective</th>
<th align="left">convergence</th>
<th align="left">outer_iterations</th>
<th align="left">inner_iterations</th>
<th align="left">inner_status</th>
<th align="left">inner_message</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">out</td>
<td align="right">3.632478</td>
<td align="left">17</td>
<td align="left">1299.262533</td>
<td align="left">0.000008</td>
<td align="left">17.000000</td>
<td align="left">83</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="even">
<td align="left">elt</td>
<td align="right">3.355214</td>
<td align="left">17</td>
<td align="left">1293.662505</td>
<td align="left">0.000000</td>
<td align="left">2.000000</td>
<td align="left">29</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="odd">
<td align="left">elt.1</td>
<td align="right">3.099114</td>
<td align="left">17</td>
<td align="left">1288.261877</td>
<td align="left">0.000000</td>
<td align="left">2.000000</td>
<td align="left">16</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="even">
<td align="left">elt.2</td>
<td align="right">2.862561</td>
<td align="left">18</td>
<td align="left">1283.093916</td>
<td align="left">0.000000</td>
<td align="left">2.000000</td>
<td align="left">15</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="odd">
<td align="left">elt.3</td>
<td align="right">2.644064</td>
<td align="left">18</td>
<td align="left">1278.110168</td>
<td align="left">0.000000</td>
<td align="left">2.000000</td>
<td align="left">15</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="even">
<td align="left">elt.4</td>
<td align="right">2.442245</td>
<td align="left">18</td>
<td align="left">1273.434884</td>
<td align="left">0.000000</td>
<td align="left">2.000000</td>
<td align="left">15</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
</tbody>
</table>
<p>An nicer view of this output comes with the option “diagnostic” in the <code>plot</code> method:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">network_models</span>, <span class="st">"diagnostic"</span><span class="op">)</span></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/diagnostic-1.png" width="672"></p>
</div>
<div id="exploring-the-path-of-networks" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-the-path-of-networks" class="anchor"></a>Exploring the path of networks</h3>
<p>By default, the <code>plot</code> method of <code>PLNnetworkfamily</code> displays evolution of the criteria mentioned above, and is a good starting point for model selection:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">network_models</span><span class="op">)</span></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/plot-1.png" width="672"></p>
<p>Note that we use the original definition of the BIC/ICL criterion (<span class="math inline">\(\texttt{loglik} - \frac{1}{2}\texttt{pen}\)</span>), which is on the same scale as the log-likelihood. A <a href="https://en.wikipedia.org/wiki/Bayesian_information_criterion">popular alternative</a> consists in using <span class="math inline">\(-2\texttt{loglik} + \texttt{pen}\)</span> instead. You can do so by specifying <code>reverse = TRUE</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">network_models</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/plot-reverse-1.png" width="672"></p>
<p>In this case, the variational lower bound of the log-likelihood is hopefully strictly increasing (or rather decreasing if using <code>reverse = TRUE</code>) with a lower level of penalty (meaning more edges in the network). The same holds true for the penalized counterpart of the variational surrogate. Generally, smoothness of these criteria is a good sanity check of optimization process. BIC and its extended-version high-dimensional version EBIC are classically used for selecting the correct amount of penalization with sparse estimator like the one used by PLN-network. However, we will consider later a more robust albeit more computationally intensive strategy to chose the appropriate number of edges in the network.</p>
<p>To pursue the analysis, we can represent the coefficient path (i.e., value of the edges in the network according to the penalty level) to see if some edges clearly come off. An alternative and more intuitive view consists in plotting the values of the partial correlations along the path, which can be obtained with the options <code>corr = TRUE</code>. To this end, we provide the S3 function <code>coefficient_path</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/coefficient_path.html">coefficient_path</a></span><span class="op">(</span><span class="va">network_models</span>, corr <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">Penalty</span>, y <span class="op">=</span> <span class="va">Coeff</span>, group <span class="op">=</span> <span class="va">Edge</span>, colour <span class="op">=</span> <span class="va">Edge</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>show.legend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_trans.html">coord_trans</a></span><span class="op">(</span>x<span class="op">=</span><span class="st">"log10"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/path_coeff-1.png" width="672"></p>
</div>
<div id="model-selection-issue-choosing-a-network" class="section level3">
<h3 class="hasAnchor">
<a href="#model-selection-issue-choosing-a-network" class="anchor"></a>Model selection issue: choosing a network</h3>
<p>To select a network with a specific level of penalty, one uses the <code><a href="../reference/getModel.PLNPCAfamily.html">getModel(lambda)</a></code> S3 method. We can also extract the best model according to the BIC or EBIC with the method <code><a href="../reference/getBestModel.PLNPCAfamily.html">getBestModel()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_pen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getModel.PLNPCAfamily.html">getModel</a></span><span class="op">(</span><span class="va">network_models</span>, <span class="va">network_models</span><span class="op">$</span><span class="va">penalties</span><span class="op">[</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span> <span class="co"># give some sparsity</span>
<span class="va">model_BIC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBestModel.PLNPCAfamily.html">getBestModel</a></span><span class="op">(</span><span class="va">network_models</span>, <span class="st">"BIC"</span><span class="op">)</span>   <span class="co"># if no criteria is specified, the best BIC is used</span></code></pre></div>
<p>An alternative strategy is to use StARS <span class="citation">(Liu, Roeder, and Wasserman <a href="#ref-stars" role="doc-biblioref">2010</a>)</span>, which performs resampling to evaluate the robustness of the network along the path of solutions in a similar fashion as the stability selection approach of <span class="citation">Meinshausen and Bühlmann (<a href="#ref-stabilitySelection" role="doc-biblioref">2010</a>)</span>, but in a network inference context.</p>
<p>Resampling can be computationally demanding but is easily parallelized: the function <code>stability_selection</code> integrates some features of the <strong>future</strong> package to perform parallel computing. We set our plan to speed the process by relying on 2 workers:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/HenrikBengtsson/future">future</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>Requesting ‘StARS’ in <code>gestBestmodel</code> invokes <code>stability_selection</code>, if it has not yet been run:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_StARS</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBestModel.PLNPCAfamily.html">getBestModel</a></span><span class="op">(</span><span class="va">network_models</span>, <span class="st">"StARS"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Stability Selection for PLNnetwork: 
## subsampling: ++++++++++++++++++++</code></pre>
<p>When “StARS” is requested for the first time, <code>getBestModel</code> automatically calls the method <code>stability_selection</code> with the default parameters. After the first call, the stability path is available from the <code>plot</code> function:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">network_models</span>, <span class="st">"stability"</span><span class="op">)</span></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/plot%20stability-1.png" width="672"></p>
</div>
<div id="structure-of-a-plnnetworkfit" class="section level3">
<h3 class="hasAnchor">
<a href="#structure-of-a-plnnetworkfit" class="anchor"></a>Structure of a <code>PLNnetworkfit</code>
</h3>
<p>The variables <code>model_BIC</code>, <code>model_StARS</code> and <code>model_pen</code> are other <code>R6Class</code> objects with class <code>PLNnetworkfit</code>. They all inherits from the class <code>PLNfit</code> and thus own all its methods, with a couple of specific one, mostly for network visualization purposes. Most fields and methods are recalled when such an object is printed:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">model_StARS</span></code></pre></div>
<pre><code>## Poisson Lognormal with sparse inverse covariance (penalty = 1.52)
## ==================================================================
##  nb_param    loglik       BIC       ICL n_edges      EBIC pen_loglik density
##        20 -1247.036 -1285.955 -2757.389       3 -1291.676  -1250.838   0.021
## ==================================================================
## * Useful fields
##     $model_par, $latent, $latent_pos, $var_par, $optim_par
##     $loglik, $BIC, $ICL, $loglik_vec, $nb_param, $criteria
## * Useful S3 methods
##     print(), coef(), sigma(), vcov(), fitted(), predict(), standard_error()
## * Additional fields for sparse network
##     $EBIC, $density, $penalty 
## * Additional S3 methods for network
##     plot.PLNnetworkfit()</code></pre>
<p>The <code>plot</code> method provides a quick representation of the inferred network, with various options (either as a matrix, a graph, and always send back the plotted object invisibly if users needs to perform additional analyses).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_graph</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_StARS</span>, plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">my_graph</span></code></pre></div>
<pre><code>## IGRAPH 3a649f5 UNW- 17 3 -- 
## + attr: name (v/c), label (v/c), label.cex (v/n), size (v/n),
## | label.color (v/c), frame.color (v/l), weight (e/n), color (e/c),
## | width (e/n)
## + edges from 3a649f5 (vertex names):
## [1] Che--Hve Glo--Hfo Hfo--Hsp</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_StARS</span><span class="op">)</span></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/stars_network-1.png" width="672"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">model_StARS</span>, type <span class="op">=</span> <span class="st">"support"</span>, output <span class="op">=</span> <span class="st">"corrplot"</span><span class="op">)</span></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/stars_network-2.png" width="672"></p>
<p>We can finally check that the fitted value of the counts – even with sparse regularization of the covariance matrix – are close to the observed ones:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  fitted   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html">fitted</a></span><span class="op">(</span><span class="va">model_StARS</span><span class="op">)</span><span class="op">)</span>,
  observed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="va">trichoptera</span><span class="op">$</span><span class="va">Abundance</span><span class="op">)</span>
<span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">observed</span>, y <span class="op">=</span> <span class="va">fitted</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">.5</span>, alpha <span class="op">=</span><span class="fl">.25</span> <span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_x_log10</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10</a></span><span class="op">(</span>limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1000</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/annotation_logticks.html">annotation_logticks</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="figure">
<img src="PLNnetwork_files/figure-html/fitted-1.png" alt="fitted value vs. observation" width="672"><p class="caption">
fitted value vs. observation
</p>
</div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-AiH89">
<p>Aitchison, J., and C. H. Ho. 1989. “The Multivariate Poisson-Log Normal Distribution.” <em>Biometrika</em> 76 (4): 643–53.</p>
</div>
<div id="ref-banerjee2008">
<p>Banerjee, Onureena, Laurent El Ghaoui, and Alexandre d’Aspremont. 2008. “Model Selection Through Sparse Maximum Likelihood Estimation for Multivariate Gaussian or Binary Data.” <em>Journal of Machine Learning Research</em> 9 (Mar): 485–516.</p>
</div>
<div id="ref-PLNnetwork">
<p>Chiquet, Julien, Stephane Robin, and Mahendra Mariadassou. 2019. “Variational Inference for Sparse Network Reconstruction from Count Data.” In <em>Proceedings of the 36th International Conference on Machine Learning</em>, edited by Kamalika Chaudhuri and Ruslan Salakhutdinov, 97:1162–71. Proceedings of Machine Learning Research. Long Beach, California, USA: PMLR. <a href="http://proceedings.mlr.press/v97/chiquet19a.html">http://proceedings.mlr.press/v97/chiquet19a.html</a>.</p>
</div>
<div id="ref-FHT08">
<p>Friedman, J., T. Hastie, and R. Tibshirani. 2008. “Sparse Inverse Covariance Estimation with the Graphical Lasso.” <em>Biostatistics</em> 9 (3): 432–41.</p>
</div>
<div id="ref-nlopt">
<p>Johnson, Steven G. 2011. <em>The Nlopt Nonlinear-Optimization Package</em>. <a href="https://nlopt.readthedocs.io/en/latest/">https://nlopt.readthedocs.io/en/latest/</a>.</p>
</div>
<div id="ref-stars">
<p>Liu, Han, Kathryn Roeder, and Larry Wasserman. 2010. “Stability Approach to Regularization Selection (Stars) for High Dimensional Graphical Models.” In <em>Proceedings of the 23rd International Conference on Neural Information Processing Systems - Volume 2</em>, 1432–40. USA.</p>
</div>
<div id="ref-stabilitySelection">
<p>Meinshausen, Nicolai, and Peter Bühlmann. 2010. “Stability Selection.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 72 (4): 417–73.</p>
</div>
<div id="ref-glassofast">
<p>Sustik, Mátyás A, and Ben Calderhead. 2012. “GLASSOFAST: An Efficient Glasso Implementation.” <em>UTCS Technical Report TR-12-29 2012</em>.</p>
</div>
<div id="ref-Svan02">
<p>Svanberg, Krister. 2002. “A Class of Globally Convergent Optimization Methods Based on Conservative Convex Separable Approximations.” <em>SIAM Journal on Optimization</em> 12 (2): 555–73.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Julien Chiquet, Mahendra Mariadassou, François Gindraud.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
