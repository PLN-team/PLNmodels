<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sparse structure estimation for multivariate count data with PLN-network • PLNmodels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Sparse structure estimation for multivariate count data with PLN-network">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PLNmodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Trichoptera.html">The trichoptera data set</a>
    </li>
    <li>
      <a href="../articles/Import_data.html">Data importation in PLNmodels</a>
    </li>
    <li>
      <a href="../articles/PLN.html">PLN: Multivariate Poisson regression</a>
    </li>
    <li>
      <a href="../articles/PLNPCA.html">PLNPCA: Dimension Reduction</a>
    </li>
    <li>
      <a href="../articles/PLNnetwork.html">PLNnetwork: sparse structure inference</a>
    </li>
    <li>
      <a href="../articles/PLNLDA.html">PLNLDA: Discriminant Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jchiquet/PLNmodels">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Sparse structure estimation for multivariate count data with PLN-network</h1>
                        <h4 class="author">PLN team</h4>
            
            <h4 class="date">2019-02-28</h4>
      
      
      <div class="hidden name"><code>PLNnetwork.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<p>This vignette illustrates the basical use of the <code>PLNnetwork</code> function and the methods accompaning the R6 Classes <code>PLNnetworkfamily</code> and <code>PLNnetworkfit</code>.</p>
<div id="requirements" class="section level3">
<h3 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h3>
<p>The packages required for the analysis are <strong>PLNmodels</strong> plus some others for data manipulation and representation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(PLNmodels)</a></code></pre></div>
</div>
<div id="data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#data-set" class="anchor"></a>Data set</h3>
<p>We illustrate our point with the trichoptera data set, a full description of which can be found in <a href="Trichoptera.html">the corresponding vignette</a>. Data preparation is also detailed in <a href="Import_data.html">the specific vignette</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(trichoptera)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">trichoptera &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prepare_data.html">prepare_data</a></span>(trichoptera<span class="op">$</span>Abundance, trichoptera<span class="op">$</span>Covariate)</a></code></pre></div>
<p>The <code>trichoptera</code> data frame stores a matrix of counts (<code>trichoptera$Abundance</code>), a matrix of offsets (<code>trichoptera$Offset</code>) and some vectors of covariates (<code>trichoptera$Wind</code>, <code>trichoptera$Temperature</code>, etc.)</p>
</div>
<div id="mathematical-background" class="section level3">
<h3 class="hasAnchor">
<a href="#mathematical-background" class="anchor"></a>Mathematical background</h3>
<p>The network model for multivariate count data that we introduce in <span class="citation">Chiquet, Mariadassou, and Robin (<a href="#ref-PLNnetwork">2018</a>)</span> is a variant of the Poisson Lognormal model of <span class="citation">Aitchison and Ho (<a href="#ref-AiH89">1989</a>)</span>, see <a href="PLN.html">the PLN vignette</a> as a reminder. Compare to the standard PLN model we add a sparsity constraint on the inverse covariance matrix <span class="math inline">\({\boldsymbol\Sigma}^{-1}\triangleq \boldsymbol\Omega\)</span> by means of the <span class="math inline">\(\ell_1\)</span>-norm, such that <span class="math inline">\(\|\boldsymbol\Omega\|_1 &lt; c\)</span>. PLN-network is the equivalent of the sparse multivariate Gaussian model <span class="citation">(Banerjee, Ghaoui, and d’Aspremont <a href="#ref-banerjee2008">2008</a>)</span> in the PLN framework. It relates some <span class="math inline">\(p\)</span>-dimensional observation vectors <span class="math inline">\(\mathbf{Y}_i\)</span> to some <span class="math inline">\(p\)</span>-dimensional vectors of Gaussian latent variables <span class="math inline">\(\mathbf{Z}_i\)</span> as follows <span class="math display">\[\begin{equation} 
  \begin{array}{rcl}
  \text{latent space } &amp;   \mathbf{Z}_i \sim \mathcal{N}\left({\boldsymbol\mu},\boldsymbol\Omega^{-1}\right) &amp;  \|\boldsymbol\Omega\|_1 &lt; c \\
  \text{observation space } &amp;  Y_{ij} | Z_{ij} \quad \text{indep.} &amp; Y_{ij} | Z_{ij} \sim \mathcal{P}\left(\exp\{Z_{ij}\}\right)
  \end{array}
\end{equation}\]</span></p>
<p>The parameter <span class="math inline">\({\boldsymbol\mu}\)</span> corresponds to the main effects and the latent covariance matrix <span class="math inline">\(\boldsymbol\Sigma\)</span> describes the underlying structure of dependence between the <span class="math inline">\(p\)</span> variables.</p>
<p>The <span class="math inline">\(\ell_1\)</span>-penalty on <span class="math inline">\(\boldsymbol\Omega\)</span> induces sparsity and selection of important direct relationships between entities. Hence, the support of <span class="math inline">\(\boldsymbol\Omega\)</span> correspond to a network of underlying interactions. The sparsity level (<span class="math inline">\(c\)</span> in the above mathematical model), which corresponds to the number of edges in the network, is controlled by a penalty parameter in the optimization process sometimes referred to as <span class="math inline">\(\lambda\)</span>. All mathematical details can be found in <span class="citation">Chiquet, Mariadassou, and Robin (<a href="#ref-PLNnetwork">2018</a>)</span>.</p>
<div id="covariates-and-offsets" class="section level4">
<h4 class="hasAnchor">
<a href="#covariates-and-offsets" class="anchor"></a>Covariates and offsets</h4>
<p>Just like PLN, PLN-network generalizes to a formulation close to a multivariate generalized linear model where the main effect is due to a linear combination of <span class="math inline">\(d\)</span> covariates <span class="math inline">\(\mathbf{x}_i\)</span> and to a vector <span class="math inline">\(\mathbf{o}_i\)</span> of <span class="math inline">\(p\)</span> offsets in sample <span class="math inline">\(i\)</span>. The latent layer then reads <span class="math display">\[\begin{equation} 
  \mathbf{Z}_i \sim \mathcal{N}\left({\mathbf{o}_i + \mathbf{x}_i^\top\boldsymbol\Theta},\boldsymbol\Omega^{-1}\right), \qquad \|\boldsymbol\Omega\|_1 &lt; c ,
\end{equation}\]</span> where <span class="math inline">\(\boldsymbol\Theta\)</span> is a <span class="math inline">\(d\times p\)</span> matrix of regression parameters.</p>
</div>
<div id="alternating-optimization" class="section level4">
<h4 class="hasAnchor">
<a href="#alternating-optimization" class="anchor"></a>Alternating optimization</h4>
<p>Regularization via sparsification of <span class="math inline">\(\boldsymbol\Omega\)</span> and vizualization of the consecutive network is the main objective in PLN-network. To reach this goal, we need to first estimate the model parameters. Inference in PLN-network focuses on the regression parameters <span class="math inline">\(\boldsymbol\Theta\)</span> and the inverse covariance <span class="math inline">\(\boldsymbol\Omega\)</span>. Technically speaking, we adopt a variational strategy to approximate the <span class="math inline">\(\ell_1\)</span>-penalized log-likelihood function and optimize the consecutive sparse variational surrogate with an optimization scheme that alternates between two step</p>
<ol style="list-style-type: decimal">
<li>a gradient-ascent-step, performed with the CCSA algorithm of <span class="citation">Svanberg (<a href="#ref-Svan02">2002</a>)</span> implemented in the C++ library <span class="citation">(Johnson <a href="#ref-nlopt">2011</a>)</span>, which we link to the package.</li>
<li>a penalized log-likelihood step, performed with the graphical-Lasso of <span class="citation">Friedman, Hastie, and Tibshirani (<a href="#ref-FHT08">2008</a>)</span>, implemented in the package <strong>fastglasso</strong> <span class="citation">(Sustik and Calderhead <a href="#ref-glassofast">2012</a>)</span>.</li>
</ol>
<p>More technical details can be found in <span class="citation">Chiquet, Mariadassou, and Robin (<a href="#ref-PLNnetwork">2018</a>)</span></p>
</div>
</div>
</div>
<div id="analysis-of-trichoptera-data-with-a-plnnetwork-model" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-trichoptera-data-with-a-plnnetwork-model" class="anchor"></a>Analysis of trichoptera data with a PLNnetwork model</h2>
<p>In the package, the sparse PLN-network model is adjusted with the function <code>PLNnetwork</code>, which we review in this section. This function adjusts the model for a series of value of the penalty parameter controling the number of edges in the network. It then provides a collection of objects with class <code>PLNnetworkfit</code>, corresponding to networks with different levels of density, all stored in an object with class <code>PLNnetworkfamily</code>.</p>
<div id="adjusting-a-collection-of-network---a-k-a--a-regularization-path" class="section level3">
<h3 class="hasAnchor">
<a href="#adjusting-a-collection-of-network---a-k-a--a-regularization-path" class="anchor"></a>Adjusting a collection of network - a.k.a. a regularization path</h3>
<p><code>PLNnetwork</code> finds an hopefully appropriate set of penalties on its own. This set can be controlled by the user, but use it with care and check details in <code><a href="../reference/PLNnetwork.html">?PLNnetwork</a></code>. The collection of models is fitted as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">network_models &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PLNnetwork.html">PLNnetwork</a></span>(Abundance <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/offset">offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(Offset)), <span class="dt">data =</span> trichoptera)</a></code></pre></div>
<pre><code>## 
##  Initialization...
##  Adjusting 30 PLN with sparse inverse covariance estimation
##  Joint optimization alternating gradient descent and graphical-lasso
##  sparsifying penalty = 3.652546 
    sparsifying penalty = 3.37375 
    sparsifying penalty = 3.116235 
    sparsifying penalty = 2.878375 
    sparsifying penalty = 2.658671 
    sparsifying penalty = 2.455737 
    sparsifying penalty = 2.268293 
    sparsifying penalty = 2.095156 
    sparsifying penalty = 1.935234 
    sparsifying penalty = 1.78752 
    sparsifying penalty = 1.65108 
    sparsifying penalty = 1.525054 
    sparsifying penalty = 1.408648 
    sparsifying penalty = 1.301127 
    sparsifying penalty = 1.201813 
    sparsifying penalty = 1.11008 
    sparsifying penalty = 1.025349 
    sparsifying penalty = 0.9470846 
    sparsifying penalty = 0.8747944 
    sparsifying penalty = 0.8080221 
    sparsifying penalty = 0.7463465 
    sparsifying penalty = 0.6893785 
    sparsifying penalty = 0.6367588 
    sparsifying penalty = 0.5881556 
    sparsifying penalty = 0.5432622 
    sparsifying penalty = 0.5017954 
    sparsifying penalty = 0.4634938 
    sparsifying penalty = 0.4281157 
    sparsifying penalty = 0.395438 
    sparsifying penalty = 0.3652546 
##  Post-treatments
##  DONE!</code></pre>
<p>Note the use of the <code>formula</code> object to specify the model, similar to the one used in the function <code>PLN</code>.</p>
</div>
<div id="structure-of-plnnetworkfamily" class="section level3">
<h3 class="hasAnchor">
<a href="#structure-of-plnnetworkfamily" class="anchor"></a>Structure of <code>PLNnetworkfamily</code>
</h3>
<p>The <code>network_models</code> variable is an <code>R6</code> object with class <code>PLNnetworkfamily</code>, which comes with a couple of methods. The most basic is the <code>show/print</code> method, which sends a very basic summary of the estimation process:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">network_models</a></code></pre></div>
<pre><code>## --------------------------------------------------------
## COLLECTION OF 30 POISSON LOGNORMAL MODELS
## --------------------------------------------------------
##  Task: Network Inference 
## ========================================================
##  - 30 penalties considered: from 0.3652546 to 3.652546 
##  - Best model (greater BIC): lambda = 0.875 
##  - Best model (greater EBIC): lambda = 0.875</code></pre>
<p>One can also easily access the successive values of the criteria in the collection</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">network_models<span class="op">$</span>criteria <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param</th>
<th align="right">nb_param</th>
<th align="right">loglik</th>
<th align="right">BIC</th>
<th align="right">ICL</th>
<th align="right">R_squared</th>
<th align="right">n_edges</th>
<th align="right">EBIC</th>
<th align="right">pen_loglik</th>
<th align="right">density</th>
<th align="left">stability</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3.652546</td>
<td align="right">17</td>
<td align="right">-1276.359</td>
<td align="right">-1309.439</td>
<td align="right">-2596.207</td>
<td align="right">0.9640030</td>
<td align="right">0</td>
<td align="right">-1309.439</td>
<td align="right">-1284.900</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">3.373750</td>
<td align="right">17</td>
<td align="right">-1267.719</td>
<td align="right">-1300.799</td>
<td align="right">-2587.568</td>
<td align="right">0.9640030</td>
<td align="right">0</td>
<td align="right">-1300.799</td>
<td align="right">-1275.947</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">3.116235</td>
<td align="right">17</td>
<td align="right">-1259.643</td>
<td align="right">-1292.724</td>
<td align="right">-2579.490</td>
<td align="right">0.9640030</td>
<td align="right">0</td>
<td align="right">-1292.724</td>
<td align="right">-1267.560</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2.878375</td>
<td align="right">17</td>
<td align="right">-1252.107</td>
<td align="right">-1285.188</td>
<td align="right">-2571.958</td>
<td align="right">0.9640031</td>
<td align="right">0</td>
<td align="right">-1285.188</td>
<td align="right">-1259.716</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="right">2.658671</td>
<td align="right">17</td>
<td align="right">-1245.086</td>
<td align="right">-1278.167</td>
<td align="right">-2564.932</td>
<td align="right">0.9640031</td>
<td align="right">0</td>
<td align="right">-1278.167</td>
<td align="right">-1252.389</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="right">2.455737</td>
<td align="right">17</td>
<td align="right">-1238.553</td>
<td align="right">-1271.634</td>
<td align="right">-2558.401</td>
<td align="right">0.9640031</td>
<td align="right">0</td>
<td align="right">-1271.634</td>
<td align="right">-1245.555</td>
<td align="right">0</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<p>A diagnostic of the optimization process is available via the <code>convergence</code> field:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">network_models<span class="op">$</span>convergence <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param</th>
<th align="left">nb_param</th>
<th align="left">objective</th>
<th align="left">convergence</th>
<th align="left">outer_iterations</th>
<th align="left">inner_iterations</th>
<th align="left">inner_status</th>
<th align="left">inner_message</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3.652546</td>
<td align="left">17</td>
<td align="left">1284.9004327991</td>
<td align="left">3.80828600442519e-07</td>
<td align="left">3</td>
<td align="left">9</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="even">
<td align="right">3.373750</td>
<td align="left">17</td>
<td align="left">1275.94700735818</td>
<td align="left">8.91646315647397e-09</td>
<td align="left">2</td>
<td align="left">9</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="odd">
<td align="right">3.116235</td>
<td align="left">17</td>
<td align="left">1267.5601479024</td>
<td align="left">2.30007659160143e-08</td>
<td align="left">2</td>
<td align="left">9</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="even">
<td align="right">2.878375</td>
<td align="left">17</td>
<td align="left">1259.71580087621</td>
<td align="left">1.1363579337099e-08</td>
<td align="left">2</td>
<td align="left">7</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="odd">
<td align="right">2.658671</td>
<td align="left">17</td>
<td align="left">1252.38915607234</td>
<td align="left">1.7831059814431e-08</td>
<td align="left">2</td>
<td align="left">10</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
<tr class="even">
<td align="right">2.455737</td>
<td align="left">17</td>
<td align="left">1245.55482418606</td>
<td align="left">1.11286893804836e-09</td>
<td align="left">2</td>
<td align="left">9</td>
<td align="left">4</td>
<td align="left">xtol_rel or xtol_abs was reached</td>
</tr>
</tbody>
</table>
<p>An nicer view of this output comes with the option “diagnostic” in the <code>plot</code> method:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(network_models, <span class="st">"diagnostic"</span>)</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/diagnostic-1.png" width="672"></p>
</div>
<div id="exploring-the-path-of-networks" class="section level3">
<h3 class="hasAnchor">
<a href="#exploring-the-path-of-networks" class="anchor"></a>Exploring the path of networks</h3>
<p>By default, the <code>plot</code> method of <code>PLNnetworkfamily</code> displays evolution of the criteria mentioned above, and is a good starting point for model selection:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(network_models)</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/plot-1.png" width="672"></p>
<p>In this case, the variational lower bound of the log-likelihood is hopefully strictly increasing with a lower level of penalty (meaning more edges in the network). The same holds true for the penalized counterpart of the variational surrogate. Generally, smoothness of these criteria is a good sanity check of optimization process. BIC and its extended-version high-dimensional version EBIC are classically used for selecting the correct amount of penalization with sparse estimator like the one used by PLN-network. However, we will consider later a more robust albeit more computationally intensive strategy to chose the appropriate number of edges in the network.</p>
<p>To pursue the analysis, we can represent the coefficient path (i.e., value of the edges in the network according to the penalty level) to see if some edges clearly come off. To this end, we provide the S3 function <code>coefficient_path</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="../reference/coefficient_path.html">coefficient_path</a></span>(network_models, <span class="dt">corr =</span> <span class="ot">FALSE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Penalty, <span class="dt">y =</span> Coeff, <span class="dt">group =</span> Edge, <span class="dt">colour =</span> Edge)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb11-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st">  </span><span class="kw">coord_trans</span>(<span class="dt">x=</span><span class="st">"log10"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/path_coeff-1.png" width="672"></p>
<p>An alternative and more intuitive view consiste in plotting the values of the partial correlations along the path.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="../reference/coefficient_path.html">coefficient_path</a></span>(network_models, <span class="dt">corr =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Penalty, <span class="dt">y =</span> Coeff, <span class="dt">group =</span> Edge, <span class="dt">colour =</span> Edge)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb12-3" data-line-number="3"><span class="st">    </span><span class="kw">geom_line</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span><span class="st"> </span><span class="kw">coord_trans</span>(<span class="dt">x =</span> <span class="st">"log10"</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/path_corr-1.png" width="672"></p>
</div>
<div id="model-selection-issue-choosing-a-network" class="section level3">
<h3 class="hasAnchor">
<a href="#model-selection-issue-choosing-a-network" class="anchor"></a>Model selection issue: choosing a network</h3>
<p>To select a network with a specific level of penalty, one uses the <code><a href="../reference/getModel.html">getModel(lambda)</a></code> S3 method. We can also extract the best model according to the BIC or EBIC with the method <code><a href="../reference/getBestModel.html">getBestModel()</a></code>.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">model_pen &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getModel.html">getModel</a></span>(network_models, network_models<span class="op">$</span>penalties[<span class="dv">20</span>]) <span class="co"># give some sparsity</span></a>
<a class="sourceLine" id="cb13-2" data-line-number="2">model_BIC &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getBestModel.html">getBestModel</a></span>(network_models, <span class="st">"BIC"</span>)   <span class="co"># if no criteria is specified, the best BIC is used</span></a></code></pre></div>
<p>An alternative strategy is to use StARS <span class="citation">(Liu, Roeder, and Wasserman <a href="#ref-stars">2010</a>)</span>, which performs resampling to evaluate the robustness of the network along the path of solutions in a similar fashion as the stability selection approach of <span class="citation">Meinshausen and Bühlmann (<a href="#ref-stabilitySelection">2010</a>)</span>, but in a network inference context.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">model_StARS &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getBestModel.html">getBestModel</a></span>(network_models, <span class="st">"StARS"</span>) <span class="co"># if StARS is requested, stabiltiy selection is performed if needed </span></a></code></pre></div>
<pre><code>## 
## Stability Selection for PLNnetwork: 
## subsampling: ++++++++++++++++++++</code></pre>
<p>When “StARS” is requested for the first time, <code>getBestModel</code> automatically calls the method <code>stability_selection</code> with the default parameters. After the first call, the stability path is available from the <code>plot</code> function:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(network_models, <span class="st">"stability"</span>)</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/plot%20stability-1.png" width="672"></p>
</div>
<div id="structure-of-a-plnnetworkfit" class="section level3">
<h3 class="hasAnchor">
<a href="#structure-of-a-plnnetworkfit" class="anchor"></a>Structure of a <code>PLNnetworkfit</code>
</h3>
<p>The variables <code>model_BIC</code>, <code>model_StARS</code> and <code>model_pen</code> are other <code>R6Class</code> objects with class <code>PLNnetworkfit</code>. They all inherits from the class <code>PLNfit</code> and thus own all its methods, with a couple of specific one, mostly for network vizualization purposes. Most fields and methods are recalled when such an object is printed:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">model_StARS</a></code></pre></div>
<pre><code>## Poisson Lognormal with sparse inverse covariance (penalty = 0.689)
## ==================================================================
##  nb_param    loglik       BIC       ICL R_squared n_edges     EBIC
##        23 -1176.952 -1221.708 -2508.402     0.964       6 -1231.07
##  pen_loglik    density
##   -1180.199 0.04152249
## ==================================================================
## * Useful fields 
##     $model_par, $latent, $var_par, $optim_par 
##     $loglik, $BIC, $ICL, $loglik_vec, $nb_param, $criteria 
## * Useful S3 methods
##     print(), coef(), vcov(), fitted(), predict(), standard_error(), fisher() 
## * Additional fields for sparse network
##     $EBIC, $density, $penalty 
## * Additional S3 methods for network
##     plot.PLNnetworkfit()</code></pre>
<p>The <code>plot</code> method provides a quick representation of the inferred network, with various options (either as a matrix, a graph, and always send back de plotted object invisibly if users needs to perform additional analyses).</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(model_BIC, <span class="dt">type =</span> <span class="st">"support"</span>, <span class="dt">output =</span> <span class="st">"corrplot"</span>)</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/support_network-1.png" width="672"></p>
<p>Here, an igraph object can be recovered.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">my_graph &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(model_StARS, <span class="dt">plot =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb20-2" data-line-number="2">my_graph</a></code></pre></div>
<pre><code>## IGRAPH 8f206a1 UNW- 17 6 -- 
## + attr: name (v/c), label (v/c), label.cex (v/n), size (v/n),
## | label.color (v/c), frame.color (v/l), weight (e/n), color (e/c),
## | width (e/n)
## + edges from 8f206a1 (vertex names):
## [1] Hym--Hsp Aga--Hsp Set--All Set--Hsp Han--Sta Hfo--Hsp</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(model_BIC)</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/partial_corr_network-1.png" width="672"></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(model_StARS)</a></code></pre></div>
<p><img src="PLNnetwork_files/figure-html/partial_corr_network-2.png" width="672"></p>
<p>We can finally check that the fitted value of the counts – even with sparse regularization of the covariance matrix – are close to the observed ones:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">  <span class="dt">fitted   =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(model_StARS)),</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="dt">observed =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(trichoptera<span class="op">$</span>Abundance)</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> observed, <span class="dt">y =</span> fitted)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">.5</span>, <span class="dt">alpha =</span>.<span class="dv">25</span> ) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="st">    </span><span class="kw">scale_x_log10</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">1000</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="st">    </span><span class="kw">scale_y_log10</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">1000</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">annotation_logticks</span>()</a></code></pre></div>
<div class="figure">
<img src="PLNnetwork_files/figure-html/fitted-1.png" alt="fitted value vs. observation" width="672"><p class="caption">
fitted value vs. observation
</p>
</div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-AiH89">
<p>Aitchison, J., and C.H. Ho. 1989. “The Multivariate Poisson-Log Normal Distribution.” <em>Biometrika</em> 76 (4). Oxford University Press: 643–53.</p>
</div>
<div id="ref-banerjee2008">
<p>Banerjee, Onureena, Laurent El Ghaoui, and Alexandre d’Aspremont. 2008. “Model Selection Through Sparse Maximum Likelihood Estimation for Multivariate Gaussian or Binary Data.” <em>Journal of Machine Learning Research</em> 9 (Mar): 485–516.</p>
</div>
<div id="ref-PLNnetwork">
<p>Chiquet, Julien, Mahendra Mariadassou, and Stéphane Robin. 2018. “Variational Inference for Sparse Network Reconstruction from Count Data.” <em>arXiv Preprint</em>. <a href="https://arxiv.org/abs/1806.03120">https://arxiv.org/abs/1806.03120</a>.</p>
</div>
<div id="ref-FHT08">
<p>Friedman, J., T. Hastie, and R. Tibshirani. 2008. “Sparse Inverse Covariance Estimation with the Graphical Lasso.” <em>Biostatistics</em> 9 (3). Biometrika Trust: 432–41.</p>
</div>
<div id="ref-nlopt">
<p>Johnson, Steven G. 2011. <em>The Nlopt Nonlinear-Optimization Package</em>. <a href="http://ab-initio.mit.edu/nlopt">http://ab-initio.mit.edu/nlopt</a>.</p>
</div>
<div id="ref-stars">
<p>Liu, Han, Kathryn Roeder, and Larry Wasserman. 2010. “Stability Approach to Regularization Selection (Stars) for High Dimensional Graphical Models.” In <em>Proceedings of the 23rd International Conference on Neural Information Processing Systems - Volume 2</em>, 1432–40. USA.</p>
</div>
<div id="ref-stabilitySelection">
<p>Meinshausen, Nicolai, and Peter Bühlmann. 2010. “Stability Selection.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 72 (4). Wiley Online Library: 417–73.</p>
</div>
<div id="ref-glassofast">
<p>Sustik, Mátyás A, and Ben Calderhead. 2012. “GLASSOFAST: An Efficient Glasso Implementation.” <em>UTCS Technical Report TR-12-29 2012</em>. University of Texas at Austin Austin.</p>
</div>
<div id="ref-Svan02">
<p>Svanberg, Krister. 2002. “A Class of Globally Convergent Optimization Methods Based on Conservative Convex Separable Approximations.” <em>SIAM Journal on Optimization</em> 12 (2). SIAM: 555–73.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#preliminaries">Preliminaries</a></li>
      <li><a href="#analysis-of-trichoptera-data-with-a-plnnetwork-model">Analysis of trichoptera data with a PLNnetwork model</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Julien Chiquet, Mahendra Mariadassou.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
