<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dimension reduction of multivariate count data with PLN-PCA • PLNmodels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Dimension reduction of multivariate count data with PLN-PCA">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PLNmodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.8.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a>
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Trichoptera.html">The trichoptera data set</a>
    </li>
    <li>
      <a href="../articles/Import_data.html">Data importation in PLNmodels</a>
    </li>
    <li>
      <a href="../articles/PLN.html">PLN: Multivariate Poisson regression</a>
    </li>
    <li>
      <a href="../articles/PLNPCA.html">PLNPCA: Dimension Reduction</a>
    </li>
    <li>
      <a href="../articles/PLNnetwork.html">PLNnetwork: sparse structure inference</a>
    </li>
    <li>
      <a href="../articles/PLNLDA.html">PLNLDA: Discriminant Analysis</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jchiquet/PLNmodels">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Dimension reduction of multivariate count data with PLN-PCA</h1>
                        <h4 class="author">PLN team</h4>
            
            <h4 class="date">2019-02-28</h4>
      
      
      <div class="hidden name"><code>PLNPCA.Rmd</code></div>

    </div>

    
    
<div id="preliminaries" class="section level2">
<h2 class="hasAnchor">
<a href="#preliminaries" class="anchor"></a>Preliminaries</h2>
<p>This vignette illustrates the basical use of the <code>PLNPCA</code> function and the methods accompaning the R6 Classes <code>PLNPCAfamily</code> and <code>PLNPCAfit</code>.</p>
<div id="requirements" class="section level3">
<h3 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h3>
<p>The packages required for the analysis are <strong>PLNmodels</strong> plus some others for data manipulation and representation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">library</a></span>(PLNmodels)</a></code></pre></div>
</div>
<div id="data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#data-set" class="anchor"></a>Data set</h3>
<p>We illustrate our point with the trichoptera data set, a full description of which can be found in <a href="Trichoptera.html">the corresponding vignette</a>. Data preparation is also detailed in <a href="Import_data.html">the specific vignette</a>.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/data">data</a></span>(trichoptera)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2">trichoptera &lt;-<span class="st"> </span><span class="kw"><a href="../reference/prepare_data.html">prepare_data</a></span>(trichoptera<span class="op">$</span>Abundance, trichoptera<span class="op">$</span>Covariate)</a></code></pre></div>
<p>The <code>trichoptera</code> data frame stores a matrix of counts (<code>trichoptera$Abundance</code>), a matrix of offsets (<code>trichoptera$Offset</code>) and some vectors of covariates (<code>trichoptera$Wind</code>, <code>trichoptera$Temperature</code>, etc.)</p>
</div>
<div id="mathematical-background" class="section level3">
<h3 class="hasAnchor">
<a href="#mathematical-background" class="anchor"></a>Mathematical background</h3>
<p>In the vein of <span class="citation">Tipping and Bishop (<a href="#ref-TiB99">1999</a>)</span>, we introduce in <span class="citation">Chiquet, Mariadassou, and Robin (<a href="#ref-PLNPCA">2018</a>)</span> a probabilistic PCA model for multivariate count data which is a variant of the Poisson Lognormal model of <span class="citation">Aitchison and Ho (<a href="#ref-AiH89">1989</a>)</span> (see <a href="PLN.html">the PLN vignette</a> as a reminder). Indeed, it can viewed as a PLN model with an additional rank constraint on the covariance matrix <span class="math inline">\(\boldsymbol\Sigma\)</span> such that <span class="math inline">\(\mathrm{rank}(\boldsymbol\Sigma)= q\)</span>.</p>
<p>This PLN-PCA model can be written in a hierachical framework where a sample of <span class="math inline">\(p\)</span>-dimensional observation vectors <span class="math inline">\(\mathbf{Y}_i\)</span> is related to some <span class="math inline">\(q\)</span>-dimensional vectors of latent variables <span class="math inline">\(\mathbf{W}_i\)</span> as follows: <span class="math display">\[\begin{equation} 
  \begin{array}{rcl}
    \text{latent space }  &amp; \mathbf{W}_i \quad \text{i.i.d.} &amp; \mathbf{W}_i \sim      \mathcal{N}(\mathbf{0}_q, \mathbf{I}_q)  \\
\text{parameter space } &amp;   \mathbf{Z}_i = {\boldsymbol\mu} + \mathbf{B}^\top \mathbf{W}_i &amp; \\
  \text{observation space } &amp;  Y_{ij} | Z_{ij} \quad \text{indep.} &amp; Y_{ij} | Z_{ij} \sim \mathcal{P}\left(\exp\{Z_{ij}\}\right)
  \end{array}
\end{equation}\]</span></p>
<p>The parameter <span class="math inline">\({\boldsymbol\mu}\in\mathbb{R}^p\)</span> corresponds to the main effects, the <span class="math inline">\(p\times q\)</span> matrix <span class="math inline">\(\mathbf{B}\)</span> to the  loadings in the parameter spaces and <span class="math inline">\(\mathbf{W}_i\)</span> to the scores of the <span class="math inline">\(i\)</span>-th observation in the low-dimensional latent subspace of the parameter space. The dimension of the latent space <span class="math inline">\(q\)</span> corresponds to the number of axes in the PCA or, in other words, to the rank of <span class="math inline">\(\mathbf{B}\mathbf{B}^\intercal\)</span>. An hopefully more intuitive way of writting this model is the following: <span class="math display">\[\begin{equation} 
  \begin{array}{rcl}
  \text{latent space } &amp;   \mathbf{Z}_i \sim \mathcal{N}({\boldsymbol\mu},\boldsymbol\Sigma), \qquad \boldsymbol\Sigma = \mathbf{B}\mathbf{B}^\top \\
  \text{observation space } &amp;  Y_{ij} | Z_{ij} \quad \text{indep.} &amp; Y_{ij} | Z_{ij} \sim \mathcal{P}\left(\exp\{Z_{ij}\}\right),
  \end{array}
\end{equation}\]</span> where the interpretation of PLN-PCA as a rank-constrained PLN model is more obvious.</p>
<div id="covariates-and-offsets" class="section level4">
<h4 class="hasAnchor">
<a href="#covariates-and-offsets" class="anchor"></a>Covariates and offsets</h4>
<p>Just like PLN, PLN-PCA generalizes to a formulation close to a multivariate generalized linear model where the main effect is due to a linear combination of <span class="math inline">\(d\)</span> covariates <span class="math inline">\(\mathbf{x}_i\)</span> and to a vector <span class="math inline">\(\mathbf{o}_i\)</span> of <span class="math inline">\(p\)</span> offsets in sample <span class="math inline">\(i\)</span>. The latent layer then reads <span class="math display">\[\begin{equation} 
  \mathbf{Z}_i \sim \mathcal{N}({\mathbf{o}_i + \mathbf{x}_i^\top\boldsymbol\Theta},\boldsymbol\Sigma), \qquad \boldsymbol\Sigma = \mathbf{B}\mathbf{B}^\top,
\end{equation}\]</span> where <span class="math inline">\(\boldsymbol\Theta\)</span> is a <span class="math inline">\(d\times p\)</span> matrix of regression parameters.</p>
</div>
<div id="optimization-by-variational-inference" class="section level4">
<h4 class="hasAnchor">
<a href="#optimization-by-variational-inference" class="anchor"></a>Optimization by Variational inference</h4>
<p>Dimension reduction and vizualization is the main objective in (PLN)-PCA. To reach this goal, we need to first estimate the model parameters. Inference in PLN-PCA focuses on the regression parameters <span class="math inline">\(\boldsymbol\Theta\)</span> and on the covariance matrix <span class="math inline">\(\boldsymbol\Sigma\)</span>. Technically speaking, we adopt a variational strategy to approximate the log-likelihood function and optimize the consecutive variational surrogate of the log-likelihood with a gradient-ascent-based approach. To this end, we rely on the CCSA algorithm of <span class="citation">Svanberg (<a href="#ref-Svan02">2002</a>)</span> implemented in the C++ library <span class="citation">(Johnson <a href="#ref-nlopt">2011</a>)</span>, which we link to the package. Technical details can be found in <span class="citation">Chiquet, Mariadassou, and Robin (<a href="#ref-PLNPCA">2018</a>)</span>.</p>
</div>
</div>
</div>
<div id="analysis-of-trichoptera-data-with-a-plnpca-model" class="section level2">
<h2 class="hasAnchor">
<a href="#analysis-of-trichoptera-data-with-a-plnpca-model" class="anchor"></a>Analysis of trichoptera data with a PLNPCA model</h2>
<p>In the package, the PLNPCA model is adjusted with the function <code>PLNPCA</code>, which we review in this section. This function adjusts the model for a series of value of <span class="math inline">\(q\)</span> and provides a collection of objects <code>PLNPCAfit</code> stored in an object with class <code>PLNPCAfamily</code>.</p>
<p>The class <code>PLNPCAfit</code> inherits from the class <code>PLNfit</code>, so we strongly recommend the reader to be comfortable with <code>PLN</code> and <code>PLNfit</code> before using <code>PLNPCA</code> (see <a href="PLN.html">the PLN vignette</a>).</p>
<div id="a-model-with-latent-main-effects-for-the-trichopetra-data-set" class="section level3">
<h3 class="hasAnchor">
<a href="#a-model-with-latent-main-effects-for-the-trichopetra-data-set" class="anchor"></a>A model with latent main effects for the Trichopetra data set</h3>
<div id="adjusting-a-collection-of-fits" class="section level4">
<h4 class="hasAnchor">
<a href="#adjusting-a-collection-of-fits" class="anchor"></a>Adjusting a collection of fits</h4>
<p>We fit a collection of <span class="math inline">\(q\)</span> models as follows:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1">PCA_models &lt;-<span class="st"> </span><span class="kw"><a href="../reference/PLNPCA.html">PLNPCA</a></span>(</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">  Abundance <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/offset">offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(Offset)),</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  <span class="dt">data  =</span> trichoptera, </a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dt">ranks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">)</a></code></pre></div>
<pre><code>## 
##  Initialization...
## 
##  Adjusting 6 PLN models for PCA analysis.
##   Rank approximation = 1 
     Rank approximation = 2 
     Rank approximation = 3 
     Rank approximation = 4 
     Rank approximation = 5 
     Rank approximation = 6 
##  Post-treatments
##  DONE!</code></pre>
<p>Note the use of the <code>formula</code> object to specify the model, similar to the one used in the function <code>PLN</code>.</p>
</div>
<div id="structure-of-plnpcafamily" class="section level4">
<h4 class="hasAnchor">
<a href="#structure-of-plnpcafamily" class="anchor"></a>Structure of <code>PLNPCAfamily</code>
</h4>
<p>The <code>PCA_models</code> variable is an <code>R6</code> object with class <code>PLNPCAfamily</code>, which comes with a couple of methods. The most basic is the <code>show/print</code> method, which sends a brief summary of the estimation process:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">PCA_models</a></code></pre></div>
<pre><code>## --------------------------------------------------------
## COLLECTION OF 6 POISSON LOGNORMAL MODELS
## --------------------------------------------------------
##  Task: Principal Component Analysis
## ========================================================
##  - Ranks considered: from 1 to 6 
##  - Best model (greater BIC): rank = 4 - R2 = 0.86 
##  - Best model (greater ICL): rank = 3 - R2 = 0.8</code></pre>
<p>One can also easily access the successive values of the criteria in the collection</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">PCA_models<span class="op">$</span>criteria <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param</th>
<th align="right">nb_param</th>
<th align="right">loglik</th>
<th align="right">BIC</th>
<th align="right">ICL</th>
<th align="right">R_squared</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">34</td>
<td align="right">-1458.2559</td>
<td align="right">-1524.417</td>
<td align="right">-1537.400</td>
<td align="right">0.4881006</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">51</td>
<td align="right">-1146.3962</td>
<td align="right">-1245.638</td>
<td align="right">-1278.650</td>
<td align="right">0.7138562</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">68</td>
<td align="right">-1057.8700</td>
<td align="right">-1190.192</td>
<td align="right">-1247.954</td>
<td align="right">0.8035052</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">85</td>
<td align="right">-1012.6385</td>
<td align="right">-1178.041</td>
<td align="right">-1267.495</td>
<td align="right">0.8607348</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="right">102</td>
<td align="right">-995.1051</td>
<td align="right">-1193.588</td>
<td align="right">-1330.300</td>
<td align="right">0.8926364</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="right">119</td>
<td align="right">-992.8091</td>
<td align="right">-1224.372</td>
<td align="right">-1417.052</td>
<td align="right">0.9043600</td>
</tr>
</tbody>
</table>
<p>A quick diagnostic of the optimization process is available via the <code>convergence</code> field:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1">PCA_models<span class="op">$</span>convergence  <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param</th>
<th align="left">nb_param</th>
<th align="left">iterations</th>
<th align="left">status</th>
<th align="left">message</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="left">34</td>
<td align="left">477</td>
<td align="left">3</td>
<td align="left">ftol_rel or ftol_abs was reached</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="left">51</td>
<td align="left">985</td>
<td align="left">3</td>
<td align="left">ftol_rel or ftol_abs was reached</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="left">68</td>
<td align="left">838</td>
<td align="left">3</td>
<td align="left">ftol_rel or ftol_abs was reached</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">85</td>
<td align="left">2098</td>
<td align="left">3</td>
<td align="left">ftol_rel or ftol_abs was reached</td>
</tr>
<tr class="odd">
<td align="right">5</td>
<td align="left">102</td>
<td align="left">3905</td>
<td align="left">3</td>
<td align="left">ftol_rel or ftol_abs was reached</td>
</tr>
<tr class="even">
<td align="right">6</td>
<td align="left">119</td>
<td align="left">2981</td>
<td align="left">3</td>
<td align="left">ftol_rel or ftol_abs was reached</td>
</tr>
</tbody>
</table>
<p>Comprehensive information about <code>PLNPCAfamily</code> is available via <code><a href="../reference/PLNPCAfamily.html">?PLNPCAfamily</a></code>.</p>
</div>
<div id="model-selection-of-rank-q" class="section level4">
<h4 class="hasAnchor">
<a href="#model-selection-of-rank-q" class="anchor"></a>Model selection of rank <span class="math inline">\(q\)</span>
</h4>
<p>The <code>plot</code> method of <code>PLNPCAfamily</code> displays evolution of the criteria mentioned above, and is a good starting point for model selection:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(PCA_models)</a></code></pre></div>
<p><img src="PLNPCA_files/figure-html/plot%20nocov-1.png" width="672"></p>
<p>In this case, the variational lower bound of the log-likelihood is hopefully strictly increasing with the number of axes (or subspace dimension). Also note the (approximated) <span class="math inline">\(R^2\)</span> which is displayed for each value of <span class="math inline">\(q\)</span> (see <span class="citation">(Chiquet, Mariadassou, and Robin <a href="#ref-PLNPCA">2018</a>)</span> for details on its computation).</p>
<p>From this plot, we can see that the best model in terms of BIC or ICL is obtained for a rank <span class="math inline">\(q=4\)</span> or <span class="math inline">\(q=3\)</span>. We may extract the corresponding model with the method <code><a href="../reference/getBestModel.html">getBestModel("ICL")</a></code>. A model with a specific rank can be extracted with the <code><a href="../reference/getModel.html">getModel()</a></code> method:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">myPCA_ICL &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getBestModel.html">getBestModel</a></span>(PCA_models, <span class="st">"ICL"</span>) </a>
<a class="sourceLine" id="cb10-2" data-line-number="2">myPCA_BIC &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getModel.html">getModel</a></span>(PCA_models, <span class="dv">3</span>) <span class="co">## getBestModel(PCA_models, "BIC")  is equivalent here </span></a></code></pre></div>
</div>
<div id="structure-of-plnpcafit" class="section level4">
<h4 class="hasAnchor">
<a href="#structure-of-plnpcafit" class="anchor"></a>Structure of <code>PLNPCAfit</code>
</h4>
<p>Objects <code>myPCA_ICL</code> and <code>myPCA_BIC</code> are <code>R6Class</code> objects of class <code>PLNPCAfit</code> which in turns own a couple of methods, some inherited from <code>PLNfit</code> and some others specific, mostly for vizualization purposes. The <code>plot</code> method provides individual maps and correlation circles as in usual PCA. If an additional classification exists for the observations – which is the case here with the available classification of the trapping nights – , it can be passed as an argument to the function.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(myPCA_ICL, <span class="dt">ind_cols =</span> trichoptera<span class="op">$</span>Group)</a></code></pre></div>
<p><img src="PLNPCA_files/figure-html/map-1.png" width="768"></p>
<p>With our PLN-PCA (and any pPCA model for count data, where successive models are not nested), it is important to performed the model selection of <span class="math inline">\(q\)</span> prior to vizualization, since the model with rank <span class="math inline">\(q=3\)</span> is not nested in the model with rank <span class="math inline">\(q=4\)</span>. Indeed, let us vizualize the first three axes of model <span class="math inline">\(q=3\)</span>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(myPCA_BIC, <span class="dt">ind_cols =</span> trichoptera<span class="op">$</span>Group)</a></code></pre></div>
<p><img src="PLNPCA_files/figure-html/map%20q3-1.png" width="768"></p>
<p>We can see that the maps for axes (1,2) is slightly different for the model with <span class="math inline">\(q=3\)</span> from the one obtained for axes (1,2) in the <span class="math inline">\(q=4\)</span> model<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a></p>
<p>Among other fields and methods (see <code><a href="../reference/PLNPCAfit.html">?PLNPCAfit</a></code> for a comprehensive view), the most interesting for the end-user in the context of PCA are</p>
<ul>
<li>the regression coefficient matrix</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/coef">coef</a></span>(myPCA_ICL) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table">
<thead><tr class="header">
<th></th>
<th align="right">(Intercept)</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Che</td>
<td align="right">-7.5673260</td>
</tr>
<tr class="even">
<td>Hyc</td>
<td align="right">-8.1530008</td>
</tr>
<tr class="odd">
<td>Hym</td>
<td align="right">-3.0236856</td>
</tr>
<tr class="even">
<td>Hys</td>
<td align="right">-6.8910881</td>
</tr>
<tr class="odd">
<td>Psy</td>
<td align="right">-0.5292095</td>
</tr>
<tr class="even">
<td>Aga</td>
<td align="right">-3.8024475</td>
</tr>
</tbody>
</table>
<ul>
<li>the estimated covariance matrix <span class="math inline">\(\boldsymbol\Sigma\)</span> with fixed rank</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/vcov">vcov</a></span>(myPCA_ICL) <span class="op">%&gt;%</span><span class="st"> </span>corrplot<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/corrplot/topics/corrplot">corrplot</a></span>(<span class="dt">is.corr =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="PLNPCA_files/figure-html/vcov-1.png" width="672"></p>
<ul>
<li>the rotation matrix (in the latent space)</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">myPCA_ICL<span class="op">$</span>rotation <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="left">Che</td>
<td align="right">-0.2331139</td>
<td align="right">0.3239463</td>
<td align="right">0.0721012</td>
</tr>
<tr class="even">
<td align="left">Hyc</td>
<td align="right">-0.4105302</td>
<td align="right">-0.3238864</td>
<td align="right">0.1398154</td>
</tr>
<tr class="odd">
<td align="left">Hym</td>
<td align="right">-0.1169437</td>
<td align="right">0.0501567</td>
<td align="right">0.3413442</td>
</tr>
<tr class="even">
<td align="left">Hys</td>
<td align="right">-0.4226411</td>
<td align="right">0.2130493</td>
<td align="right">0.4131949</td>
</tr>
<tr class="odd">
<td align="left">Psy</td>
<td align="right">0.0453492</td>
<td align="right">0.0425521</td>
<td align="right">-0.0614051</td>
</tr>
<tr class="even">
<td align="left">Aga</td>
<td align="right">0.0633525</td>
<td align="right">0.1992533</td>
<td align="right">0.2895145</td>
</tr>
</tbody></table>
<ul>
<li>the principal components values (or scores)</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">myPCA_ICL<span class="op">$</span>scores <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>() <span class="op">%&gt;%</span><span class="st"> </span>knitr<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/knitr/topics/kable">kable</a></span>()</a></code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="right">-1.602086</td>
<td align="right">-0.8968063</td>
<td align="right">0.6277273</td>
</tr>
<tr class="even">
<td align="right">3.792112</td>
<td align="right">0.1903931</td>
<td align="right">2.1702109</td>
</tr>
<tr class="odd">
<td align="right">7.565309</td>
<td align="right">-1.0019266</td>
<td align="right">-0.0957116</td>
</tr>
<tr class="even">
<td align="right">6.273697</td>
<td align="right">-0.3142092</td>
<td align="right">-2.3097141</td>
</tr>
<tr class="odd">
<td align="right">4.558364</td>
<td align="right">0.6266612</td>
<td align="right">-1.1472436</td>
</tr>
<tr class="even">
<td align="right">4.047075</td>
<td align="right">0.7725324</td>
<td align="right">0.5672517</td>
</tr>
</tbody></table>
<p><code>PLNPCAfit</code> also inherits from the methods of <code>PLNfit</code> (see the <a href="articles/PLN.html">appropriate vignette</a>). Most are recalled via the show method:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">myPCA_ICL</a></code></pre></div>
<pre><code>## Poisson Lognormal with rank constrained for PCA (rank = 3)
## ==================================================================
##  nb_param   loglik       BIC       ICL R_squared
##        68 -1057.87 -1190.192 -1247.954 0.8035052
## ==================================================================
## * Useful fields 
##     $model_par, $latent, $var_par, $optim_par 
##     $loglik, $BIC, $ICL, $loglik_vec, $nb_param, $criteria 
## * Useful S3 methods
##     print(), coef(), vcov(), fitted(), predict(), standard_error(), fisher() 
## * Additional fields for PCA
##     $percent_var, $corr_circle, $scores, $rotation 
## * Additional S3 methods for PCA
##     plot.PLNPCAfit()</code></pre>
</div>
</div>
<div id="a-model-accounting-for-meteorological-covariates" class="section level3">
<h3 class="hasAnchor">
<a href="#a-model-accounting-for-meteorological-covariates" class="anchor"></a>A model accounting for meteorological covariates</h3>
<p>A contribution of PLN-PCA is to let the possibility to taking into account some covariates in the parameter space. Such a strategy often completly changes the interpretation of PCA. Indeed, the covariates are often responsible for some strong structure in the data. The effect of the covariates should be removed since they are often quite obvious for the analyst and may hide some more important and subtile effects.</p>
<p>In the case at hand, the covariates corresponds to the meteorological variables. Let us try to introduce some of them in our model, for instance, the temperature, the wind and the cloudiness. This can be done thanks to the model formula:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">PCA_models_cov &lt;-<span class="st"> </span></a>
<a class="sourceLine" id="cb19-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/PLNPCA.html">PLNPCA</a></span>(</a>
<a class="sourceLine" id="cb19-3" data-line-number="3">    Abundance <span class="op">~</span><span class="st"> </span><span class="dv">1</span> <span class="op">+</span><span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/offset">offset</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Log">log</a></span>(Offset)) <span class="op">+</span><span class="st"> </span>Temperature <span class="op">+</span><span class="st"> </span>Wind <span class="op">+</span><span class="st"> </span>Cloudiness,</a>
<a class="sourceLine" id="cb19-4" data-line-number="4">    <span class="dt">data  =</span> trichoptera,</a>
<a class="sourceLine" id="cb19-5" data-line-number="5">    <span class="dt">ranks =</span> <span class="dv">1</span><span class="op">:</span><span class="dv">6</span></a>
<a class="sourceLine" id="cb19-6" data-line-number="6">  )</a></code></pre></div>
<pre><code>## 
##  Initialization...
## 
##  Adjusting 6 PLN models for PCA analysis.
##   Rank approximation = 1 
     Rank approximation = 2 
     Rank approximation = 3 
     Rank approximation = 4 
     Rank approximation = 5 
     Rank approximation = 6 
##  Post-treatments
##  DONE!</code></pre>
<p>Again, the best model is obtained for <span class="math inline">\(q=3\)</span> classes.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(PCA_models_cov)</a></code></pre></div>
<p><img src="PLNPCA_files/figure-html/extraction%20cov-1.png" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">myPCA_cov &lt;-<span class="st"> </span><span class="kw"><a href="../reference/getBestModel.html">getBestModel</a></span>(PCA_models_cov, <span class="st">"ICL"</span>)</a></code></pre></div>
<p>Suppose that we want to have a closer look to the first two axes. This can be done thanks to the plot method:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" data-line-number="1">gridExtra<span class="op">::</span><span class="kw"><a href="https://www.rdocumentation.org/packages/gridExtra/topics/arrangeGrob">grid.arrange</a></span>(</a>
<a class="sourceLine" id="cb23-2" data-line-number="2">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(myPCA_cov, <span class="dt">map =</span> <span class="st">"individual"</span>, <span class="dt">ind_cols =</span> trichoptera<span class="op">$</span>Group, <span class="dt">plot =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb23-3" data-line-number="3">  <span class="kw"><a href="https://www.rdocumentation.org/packages/graphics/topics/plot">plot</a></span>(myPCA_cov, <span class="dt">map =</span> <span class="st">"variable"</span>, <span class="dt">plot =</span> <span class="ot">FALSE</span>),</a>
<a class="sourceLine" id="cb23-4" data-line-number="4">  <span class="dt">ncol =</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb23-5" data-line-number="5">)</a></code></pre></div>
<p><img src="PLNPCA_files/figure-html/maps-1.png" width="672"></p>
<p>We can check that the fitted value of the counts – even with this low-rank covariance matrix – are close to the observed ones:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1"><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/data.frame">data.frame</a></span>(</a>
<a class="sourceLine" id="cb24-2" data-line-number="2">  <span class="dt">fitted   =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/stats/topics/fitted.values">fitted</a></span>(myPCA_cov)),</a>
<a class="sourceLine" id="cb24-3" data-line-number="3">  <span class="dt">observed =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/vector">as.vector</a></span>(trichoptera<span class="op">$</span>Abundance)</a>
<a class="sourceLine" id="cb24-4" data-line-number="4">) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> observed, <span class="dt">y =</span> fitted)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-6" data-line-number="6"><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="fl">.5</span>, <span class="dt">alpha =</span>.<span class="dv">25</span> ) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-7" data-line-number="7"><span class="st">    </span><span class="kw">scale_x_log10</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">1000</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-8" data-line-number="8"><span class="st">    </span><span class="kw">scale_y_log10</span>(<span class="dt">limits =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="dv">1</span>,<span class="dv">1000</span>)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb24-9" data-line-number="9"><span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">annotation_logticks</span>()</a></code></pre></div>
<div class="figure">
<img src="PLNPCA_files/figure-html/fitted-1.png" alt="fitted value vs. observation" width="672"><p class="caption">
fitted value vs. observation
</p>
</div>
</div>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-AiH89">
<p>Aitchison, J., and C.H. Ho. 1989. “The Multivariate Poisson-Log Normal Distribution.” <em>Biometrika</em> 76 (4). Oxford University Press: 643–53.</p>
</div>
<div id="ref-PLNPCA">
<p>Chiquet, Julien, Mahendra Mariadassou, and Stéphane Robin. 2018. “Variational Inference for Probabilistic Poisson Pca.” <em>The Annals of Applied Statistics</em> 12: 2674–98. <a href="http://dx.doi.org/10.1214/18-AOAS1177">http://dx.doi.org/10.1214/18-AOAS1177</a>.</p>
</div>
<div id="ref-nlopt">
<p>Johnson, Steven G. 2011. <em>The Nlopt Nonlinear-Optimization Package</em>. <a href="http://ab-initio.mit.edu/nlopt">http://ab-initio.mit.edu/nlopt</a>.</p>
</div>
<div id="ref-Svan02">
<p>Svanberg, Krister. 2002. “A Class of Globally Convergent Optimization Methods Based on Conservative Convex Separable Approximations.” <em>SIAM Journal on Optimization</em> 12 (2). SIAM: 555–73.</p>
</div>
<div id="ref-TiB99">
<p>Tipping, M. E, and C. M Bishop. 1999. “Probabilistic Principal Component Analysis.” <em>Journal of the Royal Statistical Society: Series B (Statistical Methodology)</em> 61 (3). Wiley Online Library: 611–22.</p>
</div>
</div>
</div>
<div class="footnotes">
<hr>
<ol>
<li id="fn1"><p>Percentage of variance must be interpreted with care: it sums to 100% but must be put in perspective with the model <span class="math inline">\(R^2\)</span>, giving an approximation of the total percentage of variance explained with the current model.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#preliminaries">Preliminaries</a></li>
      <li><a href="#analysis-of-trichoptera-data-with-a-plnpca-model">Analysis of trichoptera data with a PLNPCA model</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Julien Chiquet, Mahendra Mariadassou.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
