<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Clustering of multivariate count data with PLN-mixture • PLNmodels</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Clustering of multivariate count data with PLN-mixture">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">PLNmodels</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.2-9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="https://pln-team.github.io/slideshow/slides" class="external-link">Slideshow on PLN</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Trichoptera.html">The trichoptera data set</a>
    </li>
    <li>
      <a href="../articles/Import_data.html">Data importation in PLNmodels</a>
    </li>
    <li>
      <a href="../articles/PLN.html">PLN: Multivariate Poisson regression</a>
    </li>
    <li>
      <a href="../articles/PLNPCA.html">PLNPCA: Dimension Reduction</a>
    </li>
    <li>
      <a href="../articles/PLNnetwork.html">PLNnetwork: sparse structure inference</a>
    </li>
    <li>
      <a href="../articles/PLNLDA.html">PLNLDA: Discriminant Analysis</a>
    </li>
    <li>
      <a href="../articles/PLNmixture.html">PLNmixture: Model-based clustering for counts</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/pln-team/PLNmodels/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Clustering of multivariate count data with
PLN-mixture</h1>
                        <h4 data-toc-skip class="author">PLN team</h4>
            
            <h4 data-toc-skip class="date">2025-07-10</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/pln-team/PLNmodels/blob/master/vignettes/PLNmixture.Rmd" class="external-link"><code>vignettes/PLNmixture.Rmd</code></a></small>
      <div class="hidden name"><code>PLNmixture.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h2>
<p>This vignette illustrates the standard use of the
<code>PLNmixture</code> function and the methods accompanying the R6
Classes <code>PLNmixturefamily</code> and
<code>PLNmixturefit</code>.</p>
<div class="section level3">
<h3 id="requirements">Requirements<a class="anchor" aria-label="anchor" href="#requirements"></a>
</h3>
<p>The packages required for the analysis are <strong>PLNmodels</strong>
plus some others for data manipulation and representation:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://pln-team.github.io/PLNmodels/">PLNmodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra" class="external-link">factoextra</a></span><span class="op">)</span></span></code></pre></div>
<p>The main function <code>PLNmixture</code> integrates some features of
the <strong>future</strong> package to perform parallel computing: you
can set your plan to speed the fit by relying on 2 workers as
follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="data-set">Data set<a class="anchor" aria-label="anchor" href="#data-set"></a>
</h3>
<p>We illustrate our point with the trichoptera data set, a full
description of which can be found in <a href="Trichoptera.html">the
corresponding vignette</a>. Data preparation is also detailed in <a href="Import_data.html">the specific vignette</a>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">trichoptera</span><span class="op">)</span></span>
<span><span class="va">trichoptera</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/prepare_data.html">prepare_data</a></span><span class="op">(</span><span class="va">trichoptera</span><span class="op">$</span><span class="va">Abundance</span>, <span class="va">trichoptera</span><span class="op">$</span><span class="va">Covariate</span><span class="op">)</span></span></code></pre></div>
<p>The <code>trichoptera</code> data frame stores a matrix of counts
(<code>trichoptera$Abundance</code>), a matrix of offsets
(<code>trichoptera$Offset</code>) and some vectors of covariates
(<code>trichoptera$Wind</code>, <code>trichoptera$Temperature</code>,
etc.)</p>
</div>
<div class="section level3">
<h3 id="mathematical-background">Mathematical background<a class="anchor" aria-label="anchor" href="#mathematical-background"></a>
</h3>
<p>PLN-mixture for multivariate count data is a variant of the Poisson
Lognormal model of <span class="citation">Aitchison and Ho (<a href="#ref-AiH89">1989</a>)</span> (see <a href="PLN.html">the PLN
vignette</a> as a reminder) which can be viewed as a PLN model with an
additional mixture layer in the model: the latent observations found in
the first layer are assumed to be drawn from a mixture of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
multivariate Gaussian components. Each component
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
has a prior probability
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>i</mi><mo>∈</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msub><mi>π</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">p(i \in k) = \pi_k</annotation></semantics></math>
such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mo>∑</mo><mi>k</mi></msub><msub><mi>π</mi><mi>k</mi></msub><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\sum_k \pi_k = 1</annotation></semantics></math>.
We denote by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub><mo>∈</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mi>K</mi><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">C_i\in \{1,\dots,K\}</annotation></semantics></math>
the multinomial variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℳ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>𝛑</mi><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>π</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>π</mi><mi>K</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{M}(1,\boldsymbol{\pi} = (\pi_1,\dots,\pi_K))</annotation></semantics></math>
describing the component to which observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
belongs to. Introducing this additional layer, our PLN mixture model is
as follows</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">layer 2 (clustering)</mtext></mtd><mtd columnalign="center" style="text-align: center"><mi>𝐂</mi><mi>_</mi><mi>i</mi><mo>∼</mo><mi>ℳ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>,</mo><mi>𝛑</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">layer 1 (Gaussian)</mtext></mtd><mtd columnalign="center" style="text-align: center"><mi>𝐙</mi><mi>_</mi><mi>i</mi><mo stretchy="false" form="prefix">|</mo><mspace width="0.167em"></mspace><mi>𝐂</mi><mi>_</mi><mi>i</mi><mo>=</mo><mi>k</mi><mo>∼</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>𝛍</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>𝚺</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mrow><mtext mathvariant="normal">observation space </mtext><mspace width="0.333em"></mspace></mrow></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>Y</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mo stretchy="false" form="postfix">∥</mo><msub><mi>Z</mi><mrow><mi>i</mi><mi>j</mi></mrow></msub><mspace width="1.0em"></mspace><mtext mathvariant="normal">indep.</mtext></mtd><mtd columnalign="left" style="text-align: left"><msub><mi>𝐘</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>𝐙</mi><mi>i</mi></msub><mo>∼</mo><mi>𝒫</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>exp</mo><mo stretchy="false" form="prefix">{</mo><msub><mi>𝐙</mi><mi>i</mi></msub><mo stretchy="false" form="postfix">}</mo><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{rcl}
\text{layer 2 (clustering)} &amp; \mathbf{C}\_i \sim \mathcal{M}(1,\boldsymbol{\pi}) \\
\text{layer 1 (Gaussian)} &amp; \mathbf{Z}\_i | \, \mathbf{C}\_i = k
\sim \mathcal{N}({\boldsymbol\mu}^{(k)},
{\boldsymbol\Sigma}^{(k)}), \\ 
\text{observation space } &amp; Y_{ij} \| Z_{ij} \quad \text{indep.} &amp; \mathbf{Y}_i |
\mathbf{Z}_i\sim\mathcal{P}\left(\exp\{\mathbf{Z}_i\}\right).
\end{array}
</annotation></semantics></math></p>
<div class="section level4">
<h4 id="covariates-and-offsets">Covariates and offsets<a class="anchor" aria-label="anchor" href="#covariates-and-offsets"></a>
</h4>
<p>Just like PLN, PLN-mixture generalizes to a formulation where the
main effect is due to a linear combination of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>d</mi><annotation encoding="application/x-tex">d</annotation></semantics></math>
covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐱</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{x}_i</annotation></semantics></math>
and to a vector
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐨</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{o}_i</annotation></semantics></math>
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
offsets in sample
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>i</mi><annotation encoding="application/x-tex">i</annotation></semantics></math>
in each mixture component. The latent layer then reads</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝐙</mi><mi>i</mi></msub><mo stretchy="false" form="prefix">|</mo><msub><mi>𝐂</mi><mi>i</mi></msub><mo>=</mo><mi>k</mi><mspace width="0.167em"></mspace><mo>∼</mo><mi>𝒩</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mrow><msub><mi>𝐨</mi><mi>i</mi></msub><mo>+</mo><msubsup><mi>𝐱</mi><mi>i</mi><mi>⊤</mi></msubsup><mi>𝐁</mi><mo>+</mo><mi>𝛍</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo>,</mo><msup><mi>𝚺</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mathbf{Z}_i | \mathbf{C}_i = k \, \sim
\mathcal{N}({\mathbf{o}_i +
\mathbf{x}_i^{\top}{\mathbf{B}} + \boldsymbol\mu}^{(k)},{\boldsymbol\Sigma}^{(k)}),
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐁</mi><annotation encoding="application/x-tex">{\mathbf{B}}</annotation></semantics></math>
is a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">d\times p</annotation></semantics></math>
matrix of regression parameters common to all the mixture
components.</p>
</div>
<div class="section level4">
<h4 id="parametrization-of-the-covariance-of-the-mixture-models">Parametrization of the covariance of the mixture models<a class="anchor" aria-label="anchor" href="#parametrization-of-the-covariance-of-the-mixture-models"></a>
</h4>
<p>When using parametric mixture models like Gaussian mixture models, it
is generally not recommended to have covariances matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>𝚺</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msup><annotation encoding="application/x-tex">{\boldsymbol\Sigma}^{(k)}</annotation></semantics></math>
with no special restriction, especially when dealing with a large number
of variables. Indeed, the total number of parameters to estimate in such
unrestricted model can become prohibitive.</p>
<p>To reduce the computational burden and avoid over-fitting the data,
two different, more constrained parametrizations of the covariance
matrices of each component are currently implemented in the
<code>PLNmodels</code> package (on top of the general form of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Σ</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\Sigma_k</annotation></semantics></math>):</p>
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">diagonal covariances:</mtext></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>Σ</mi><mi>k</mi></msub></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><mrow><mi mathvariant="normal">d</mi><mi mathvariant="normal">i</mi><mi mathvariant="normal">a</mi><mi mathvariant="normal">g</mi></mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>d</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">(</mtext><mrow><mn>2</mn><mi>K</mi><mi>p</mi></mrow><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> parameters),</mtext></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">spherical covariances:</mtext></mtd><mtd columnalign="right" style="text-align: right"><msub><mi>Σ</mi><mi>k</mi></msub></mtd><mtd columnalign="center" style="text-align: center"><mo>=</mo></mtd><mtd columnalign="left" style="text-align: left"><msubsup><mi>σ</mi><mi>k</mi><mn>2</mn></msubsup><mi>I</mi></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">(</mtext><mrow><mi>K</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo>+</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mspace width="0.333em"></mspace><mtext mathvariant="normal"> parameters).</mtext></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{equation*}
\begin{array}{rrcll}
    \text{diagonal covariances:} &amp; \Sigma_k &amp; = &amp;\mathrm{diag}({d}_k) &amp; \text{($2 K p$ parameters),} \\[1.5ex]
    \text{spherical covariances:} &amp; \Sigma_k &amp; = &amp;  \sigma_k^2 {I} &amp; \text{($K (p + 1)$ parameters).} 
\end{array}
\end{equation*}</annotation></semantics></math><p>The diagonal structure assumes that, given the group membership of a
site, all variable abundances are independent. The spherical structure
further assumes that all species have the same biological variability.
In particular, in both parametrisations, all observed covariations are
caused only by the group structure.</p>
<p>For readers familiar with the <code>mclust</code> <code>R</code>
package <span class="citation">(<a href="#ref-fraley1999">Fraley and
Raftery 1999</a>)</span>, which implements Gaussian mixture models with
many variants of covariance matrices of each component, the spherical
model corresponds to <code>VII</code> (spherical, unequal volume) and
the diagonal model to <code>VVI</code> (diagonal, varying volume and
shape). {Using constrained forms of the covariance matrices enables}
PLN-mixture to {provide a clustering} even when the number of sites
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
remains of the same order, or smaller, than the number of species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.</p>
</div>
<div class="section level4">
<h4 id="optimization-by-variational-inference">Optimization by Variational inference<a class="anchor" aria-label="anchor" href="#optimization-by-variational-inference"></a>
</h4>
<p>Just like with all models fitted in PLNmodels, we adopt a variational
strategy to approximate the log-likelihood function and optimize the
consecutive variational surrogate of the log-likelihood with a
gradient-ascent-based approach. In this case, it is not too difficult to
show that PLN-mixture can be obtained by optimizing a collection of
weighted standard PLN models.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="analysis-of-trichoptera-data-with-a-pln-mixture-model">Analysis of trichoptera data with a PLN-mixture model<a class="anchor" aria-label="anchor" href="#analysis-of-trichoptera-data-with-a-pln-mixture-model"></a>
</h2>
<p>In the package, the PLN-mixture model is adjusted with the function
<code>PLNmixture</code>, which we review in this section. This function
adjusts the model for a series of value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
and provides a collection of objects <code>PLNmixturefit</code> stored
in an object with class <code>PLNmixturefamily</code>.</p>
<p>The class <code>PLNmixturefit</code> contains a collection of
components constituting the mixture, each of whom inherits from the
class <code>PLNfit</code>, so we strongly recommend the reader to be
comfortable with <code>PLN</code> and <code>PLNfit</code> before using
<code>PLNmixture</code> (see <a href="PLN.html">the PLN
vignette</a>).</p>
<div class="section level3">
<h3 id="a-mixture-model-with-a-latent-main-effects-for-the-trichoptera-data-set">A mixture model with a latent main effects for the Trichoptera data
set<a class="anchor" aria-label="anchor" href="#a-mixture-model-with-a-latent-main-effects-for-the-trichoptera-data-set"></a>
</h3>
<div class="section level4">
<h4 id="adjusting-a-collection-of-fits">Adjusting a collection of fits<a class="anchor" aria-label="anchor" href="#adjusting-a-collection-of-fits"></a>
</h4>
<p>We fit a collection of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mo>=</mo><mn>5</mn></mrow><annotation encoding="application/x-tex">K=5</annotation></semantics></math>
models with one iteration of forward smoothing of the log-likelihood as
follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixture_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/PLNmixture.html">PLNmixture</a></span><span class="op">(</span></span>
<span>  <span class="va">Abundance</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Offset</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  data  <span class="op">=</span> <span class="va">trichoptera</span>,</span>
<span>  clusters <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Initialization...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Adjusting 4 PLN mixture models.</span></span>
<span><span class="co">##  number of cluster = 1   number of cluster = 2   number of cluster = 3   number of cluster = 4 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">##  Smoothing PLN mixture models.</span></span>
<span><span class="co">##    Going backward +++                                                                                                       Going forward +++                                                                                                    </span></span>
<span><span class="co">##  Post-treatments</span></span>
<span><span class="co">##  DONE!</span></span></code></pre>
<p>Note the use of the <code>formula</code> object to specify the model,
similar to the one used in the function <code>PLN</code>.</p>
</div>
<div class="section level4">
<h4 id="structure-of-plnmixturefamily">Structure of <code>PLNmixturefamily</code><a class="anchor" aria-label="anchor" href="#structure-of-plnmixturefamily"></a>
</h4>
<p>The <code>mixture_models</code> variable is an <code>R6</code> object
with class <code>PLNmixturefamily</code>, which comes with a couple of
methods. The most basic is the <code>show/print</code> method, which
outputs a brief summary of the estimation process:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixture_models</span></span></code></pre></div>
<pre><code><span><span class="co">## --------------------------------------------------------</span></span>
<span><span class="co">## COLLECTION OF 4 POISSON LOGNORMAL MODELS</span></span>
<span><span class="co">## --------------------------------------------------------</span></span>
<span><span class="co">##  Task: Mixture Model </span></span>
<span><span class="co">## ========================================================</span></span>
<span><span class="co">##  - Number of clusters considered: from 1 to 4 </span></span>
<span><span class="co">##  - Best model (regarding BIC): cluster = 2 </span></span>
<span><span class="co">##  - Best model (regarding ICL): cluster = 4</span></span></code></pre>
<p>One can also easily access the successive values of the criteria in
the collection</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixture_models</span><span class="op">$</span><span class="va">criteria</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">param</th>
<th align="right">nb_param</th>
<th align="right">loglik</th>
<th align="right">BIC</th>
<th align="right">ICL</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">18</td>
<td align="right">-1158.510</td>
<td align="right">-1193.536</td>
<td align="right">-2152.473</td>
</tr>
<tr class="even">
<td align="right">2</td>
<td align="right">37</td>
<td align="right">-1104.275</td>
<td align="right">-1176.274</td>
<td align="right">-1982.181</td>
</tr>
<tr class="odd">
<td align="right">3</td>
<td align="right">56</td>
<td align="right">-1070.275</td>
<td align="right">-1179.246</td>
<td align="right">-1887.746</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="right">75</td>
<td align="right">-1041.142</td>
<td align="right">-1187.085</td>
<td align="right">-1790.797</td>
</tr>
</tbody>
</table>
<p>A quick diagnostic of the optimization process is available via the
<code>convergence</code> field:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixture_models</span><span class="op">$</span><span class="va">convergence</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">param</th>
<th align="left">nb_param</th>
<th align="left">objective</th>
<th align="left">convergence</th>
<th align="left">outer_iterations</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">out</td>
<td align="right">1</td>
<td align="left">18</td>
<td align="left">1158.51</td>
<td align="left">1.267482e-06</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">elt</td>
<td align="right">2</td>
<td align="left">37</td>
<td align="left">1104.275</td>
<td align="left">2.125086e-06</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">elt.1</td>
<td align="right">3</td>
<td align="left">56</td>
<td align="left">1070.275</td>
<td align="left">5.373082e-07</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">elt.2</td>
<td align="right">4</td>
<td align="left">75</td>
<td align="left">1041.142</td>
<td align="left">3.861067e-07</td>
<td align="left">2</td>
</tr>
</tbody>
</table>
<p>A visual representation of the optimization can be obtained be
representing the objective function</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixture_models</span><span class="op">$</span><span class="fu">plot_objective</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="PLNmixture_files/figure-html/objective-1.png" width="700"></p>
<p>Comprehensive information about <code>PLNmixturefamily</code> is
available via <code><a href="../reference/PLNmixturefamily.html">?PLNmixturefamily</a></code>.</p>
</div>
<div class="section level4">
<h4 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h4>
<p>The <code>plot</code> method of <code>PLNmixturefamily</code>
displays evolution of the criteria mentioned above, and is a good
starting point for model selection:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mixture_models</span><span class="op">)</span></span></code></pre></div>
<p><img src="PLNmixture_files/figure-html/plot%20nocov-1.png" width="672"></p>
<p>Note that we use the original definition of the BIC/ICL criterion
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="monospace">𝚕𝚘𝚐𝚕𝚒𝚔</mtext><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mtext mathvariant="monospace">𝚙𝚎𝚗</mtext></mrow><annotation encoding="application/x-tex">\texttt{loglik} - \frac{1}{2}\texttt{pen}</annotation></semantics></math>),
which is on the same scale as the log-likelihood. A <a href="https://en.wikipedia.org/wiki/Bayesian_information_criterion" class="external-link">popular
alternative</a> consists in using
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mn>2</mn><mtext mathvariant="monospace">𝚕𝚘𝚐𝚕𝚒𝚔</mtext><mo>+</mo><mtext mathvariant="monospace">𝚙𝚎𝚗</mtext></mrow><annotation encoding="application/x-tex">-2\texttt{loglik} + \texttt{pen}</annotation></semantics></math>
instead. You can do so by specifying <code>reverse = TRUE</code>:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mixture_models</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="PLNmixture_files/figure-html/plot%20nocov-reverse-1.png" width="672"></p>
<p>From those plots, we can see that the best model in terms of BIC is
obtained for a number of clusters of 2. We may extract the corresponding
model with the method <code><a href="../reference/getBestModel.html">getBestModel()</a></code>. A model with a
specific number of clusters can also be extracted with the
<code><a href="../reference/getModel.html">getModel()</a></code> method:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMix_BIC</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getBestModel.html">getBestModel</a></span><span class="op">(</span><span class="va">mixture_models</span>, <span class="st">"BIC"</span><span class="op">)</span></span>
<span><span class="va">myMix_2</span>   <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getModel.html">getModel</a></span><span class="op">(</span><span class="va">mixture_models</span>, <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="structure-of-plnmixturefit">Structure of <code>PLNmixturefit</code><a class="anchor" aria-label="anchor" href="#structure-of-plnmixturefit"></a>
</h4>
<p>Object <code>myMix_BIC</code> is an <code>R6Class</code> object with
class <code>PLNmixturefit</code> which in turns has a couple of methods.
A good place to start is the <code>show/print</code> method:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMix_BIC</span></span></code></pre></div>
<pre><code><span><span class="co">## Poisson Lognormal mixture model with 2 components and spherical covariances.</span></span>
<span><span class="co">## * Useful fields</span></span>
<span><span class="co">##     $posteriorProb, $memberships, $mixtureParam, $group_means</span></span>
<span><span class="co">##     $model_par, $latent, $latent_pos, $optim_par</span></span>
<span><span class="co">##     $loglik, $BIC, $ICL, $loglik_vec, $nb_param, $criteria</span></span>
<span><span class="co">##     $component[[i]] (a PLNfit with associated methods and fields)</span></span>
<span><span class="co">## * Useful S3 methods</span></span>
<span><span class="co">##     print(), coef(), sigma(), fitted(), predict()</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="specific-fields">Specific fields<a class="anchor" aria-label="anchor" href="#specific-fields"></a>
</h4>
<p>The user can easily access several fields of the
<code>PLNmixturefit</code> object using active binding or
<code>S3</code> methods:</p>
<ul>
<li>the vector of group memberships:</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMix_BIC</span><span class="op">$</span><span class="va">memberships</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 1 2 1 1 1 1 1 1 1 2 2 2 2 2 2 2</span></span>
<span><span class="co">## [39] 2 2 2 2 2 2 2 2 2 2 1</span></span></code></pre>
<ul>
<li>the group proportions:</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMix_BIC</span><span class="op">$</span><span class="va">mixtureParam</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.1836735 0.8163265</span></span></code></pre>
<ul>
<li>the posterior probabilities (often close to the boundaries
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{0,1\}</annotation></semantics></math>):</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMix_BIC</span><span class="op">$</span><span class="va">posteriorProb</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody></table>
<ul>
<li>a list of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>p</mi></mrow><annotation encoding="application/x-tex">p \times p</annotation></semantics></math>
covariance matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>𝚺</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\boldsymbol{\Sigma}}</annotation></semantics></math>
(here spherical variances):</li>
</ul>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/sigma.html" class="external-link">sigma</a></span><span class="op">(</span><span class="va">myMix_BIC</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">as.matrix</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">diag</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [[1]]</span></span>
<span><span class="co">##      Che      Hyc      Hym      Hys      Psy      Aga      Glo      Ath </span></span>
<span><span class="co">## 0.962438 0.962438 0.962438 0.962438 0.962438 0.962438 0.962438 0.962438 </span></span>
<span><span class="co">##      Cea      Ced      Set      All      Han      Hfo      Hsp      Hve </span></span>
<span><span class="co">## 0.962438 0.962438 0.962438 0.962438 0.962438 0.962438 0.962438 0.962438 </span></span>
<span><span class="co">##      Sta </span></span>
<span><span class="co">## 0.962438 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## [[2]]</span></span>
<span><span class="co">##       Che       Hyc       Hym       Hys       Psy       Aga       Glo       Ath </span></span>
<span><span class="co">## 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 </span></span>
<span><span class="co">##       Cea       Ced       Set       All       Han       Hfo       Hsp       Hve </span></span>
<span><span class="co">## 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 0.7187567 </span></span>
<span><span class="co">##       Sta </span></span>
<span><span class="co">## 0.7187567</span></span></code></pre>
<ul>
<li>the regression coefficient matrix and other model of parameters
(results not shown here, redundant with other fields)</li>
</ul>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, <span class="st">'main'</span><span class="op">)</span>       <span class="co"># equivalent to myMix_BIC$model_par$Theta</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, <span class="st">'mixture'</span><span class="op">)</span>    <span class="co"># equivalent to myMix_BIC$model_par$Pi, myMix_BIC$mixtureParam</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, <span class="st">'means'</span><span class="op">)</span>      <span class="co"># equivalent to myMix_BIC$model_par$Mu, myMix_BIC$group_means</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, <span class="st">'covariance'</span><span class="op">)</span> <span class="co"># equivalent to myMix_BIC$model_par$Sigma, sigma(myMix_BIC)</span></span></code></pre></div>
<ul>
<li>the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mo>×</mo><mi>K</mi></mrow><annotation encoding="application/x-tex">p \times K</annotation></semantics></math>
matrix of group means
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐌</mi><annotation encoding="application/x-tex">\mathbf{M}</annotation></semantics></math>
</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMix_BIC</span><span class="op">$</span><span class="va">group_means</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">Intercept</th>
<th align="right">Intercept.1</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Che</td>
<td align="right">-22.14</td>
<td align="right">-7.16</td>
</tr>
<tr class="even">
<td align="left">Hyc</td>
<td align="right">-7.71</td>
<td align="right">-8.33</td>
</tr>
<tr class="odd">
<td align="left">Hym</td>
<td align="right">-4.87</td>
<td align="right">-2.68</td>
</tr>
<tr class="even">
<td align="left">Hys</td>
<td align="right">-8.40</td>
<td align="right">-6.59</td>
</tr>
<tr class="odd">
<td align="left">Psy</td>
<td align="right">-0.81</td>
<td align="right">-0.53</td>
</tr>
<tr class="even">
<td align="left">Aga</td>
<td align="right">-6.97</td>
<td align="right">-3.72</td>
</tr>
</tbody>
</table>
<p>In turn, each component of a <code>PLNmixturefit</code> is a
<code>PLNfit</code> object (see the corresponding <a href="PLN.html">vignette</a>)</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myMix_BIC</span><span class="op">$</span><span class="va">components</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">## A multivariate Poisson Lognormal fit with spherical covariance model.</span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">##  nb_param loglik      BIC    AIC     ICL</span></span>
<span><span class="co">##        18 -252.7 -287.726 -270.7 167.536</span></span>
<span><span class="co">## ==================================================================</span></span>
<span><span class="co">## * Useful fields</span></span>
<span><span class="co">##     $model_par, $latent, $latent_pos, $var_par, $optim_par</span></span>
<span><span class="co">##     $loglik, $BIC, $ICL, $loglik_vec, $nb_param, $criteria</span></span>
<span><span class="co">## * Useful S3 methods</span></span>
<span><span class="co">##     print(), coef(), sigma(), vcov(), fitted()</span></span>
<span><span class="co">##     predict(), predict_cond(), standard_error()</span></span></code></pre>
<p>The <code>PLNmixturefit</code> class also benefits from two important
methods: <code>plot</code> and <code>predict</code>.</p>
</div>
<div class="section level4">
<h4 id="plot-method">
<code>plot</code> method<a class="anchor" aria-label="anchor" href="#plot-method"></a>
</h4>
<p>We can visualize the clustered latent position by performing a PCA on
the latent layer:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, <span class="st">"pca"</span><span class="op">)</span></span></code></pre></div>
<p><img src="PLNmixture_files/figure-html/plot%20clustering-1.png" width="700"></p>
<p>We can also plot the data matrix with samples reordered by clusters
to check whether it exhibits strong pattern or not. The limits between
clusters are highlighted by grey lines.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, <span class="st">"matrix"</span><span class="op">)</span></span></code></pre></div>
<p><img src="PLNmixture_files/figure-html/plot%20reordered%20data-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="predict-method">
<code>predict</code> method<a class="anchor" aria-label="anchor" href="#predict-method"></a>
</h4>
<p>For PLNmixture, the goal of <code>predict</code> is to predict the
membership based on observed newly <em>species counts</em>.</p>
<p>By default, the <code>predict</code> use the argument
<code>type = "posterior"</code> to output the matrix of posterior
probabilities
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>π</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><annotation encoding="application/x-tex">\hat{\pi}_k</annotation></semantics></math></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted.class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, newdata <span class="op">=</span> <span class="va">trichoptera</span><span class="op">)</span></span>
<span><span class="co">## equivalent to </span></span>
<span><span class="co">## predicted.class &lt;- predict(myMIX_BIC, newdata = trichoptera,  type = "posterior")</span></span>
<span><span class="va">predicted.class</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<table class="table"><tbody>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">0</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">0</td>
<td align="right">1</td>
</tr>
</tbody></table>
<p>Setting <code>type = "response"</code>, we can predict the most
likely cluster
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>k</mi><mo accent="true">̂</mo></mover><mo>=</mo><mo>arg</mo><msub><mo>max</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn><mi>…</mi><mi>K</mi></mrow></msub><mo stretchy="false" form="prefix">{</mo><mover><msub><mi>π</mi><mi>k</mi></msub><mo accent="true">̂</mo></mover><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\hat{k} = \arg\max_{k = 1\dots K} \{ \hat{\pi_k}\}</annotation></semantics></math>
instead:</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted.class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, newdata <span class="op">=</span> <span class="va">trichoptera</span>, </span>
<span>                           prior <span class="op">=</span> <span class="va">myMix_BIC</span><span class="op">$</span><span class="va">posteriorProb</span>,  type <span class="op">=</span> <span class="st">"response"</span><span class="op">)</span></span>
<span><span class="va">predicted.class</span></span></code></pre></div>
<pre><code><span><span class="co">##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 </span></span>
<span><span class="co">##  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  1  2  1  1 </span></span>
<span><span class="co">## 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 </span></span>
<span><span class="co">##  1  1  1  1  1  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  2  1 </span></span>
<span><span class="co">## Levels: 1 2</span></span></code></pre>
<p>We can assess that the predictions are quite similar to the real
group (<em>this is not a proper validation of the method as we used data
set for both model fitting and prediction and are thus at risk of
overfitting</em>).</p>
<p>Finally, we can get the coordinates of the new data on the same graph
at the original ones with <code>type = "position"</code>. This is done
by averaging the latent positions
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>𝐙</mi><mo accent="true">̂</mo></mover><mi>i</mi></msub><mo>+</mo><msub><mi>𝛍</mi><mi>k</mi></msub></mrow><annotation encoding="application/x-tex">\hat{\mathbf{Z}}_i + \boldsymbol{\mu}_k</annotation></semantics></math>
(found when the sample is assumed to come from group
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>)
and weighting them with the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mover><mi>π</mi><mo accent="true">̂</mo></mover><mi>k</mi></msub><annotation encoding="application/x-tex">\hat{\pi}_k</annotation></semantics></math>.
Some samples, have compositions that put them very far from their group
mean.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predicted.position</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">myMix_BIC</span>, newdata <span class="op">=</span> <span class="va">trichoptera</span>, </span>
<span>                              prior <span class="op">=</span> <span class="va">myMix_BIC</span><span class="op">$</span><span class="va">posteriorProb</span>, type <span class="op">=</span> <span class="st">"position"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html" class="external-link">prcomp</a></span><span class="op">(</span><span class="va">predicted.position</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">factoextra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html" class="external-link">fviz_pca_ind</a></span><span class="op">(</span>col.ind <span class="op">=</span> <span class="va">predicted.class</span><span class="op">)</span></span></code></pre></div>
<p><img src="PLNmixture_files/figure-html/predicted_position-1.png" width="672"></p>
<p>When you are done, do not forget to get back to the standard
sequential plan with <em>future</em>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">future</span><span class="fu">::</span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="st">"sequential"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-AiH89" class="csl-entry">
Aitchison, J., and C. H. Ho. 1989. <span>“The Multivariate Poisson-Log
Normal Distribution.”</span> <em>Biometrika</em> 76 (4): 643–53.
</div>
<div id="ref-fraley1999" class="csl-entry">
Fraley, Chris, and Adrian E. Raftery. 1999. <span>“MCLUST: Software for
Model-Based Cluster Analysis.”</span> <em>Journal of Classification</em>
16 (2): 297–306. <a href="https://doi.org/10.1007/s003579900058" class="external-link">https://doi.org/10.1007/s003579900058</a>.
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Julien Chiquet, Mahendra Mariadassou, Stéphane Robin, François Gindraud.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
